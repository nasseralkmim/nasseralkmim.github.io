<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Text processing with spaCy | Notes</title>
  <link rel = 'canonical' href = 'https://nasseralkmim.github.io/notes/text-processing-python/'>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Text processing with spaCy" />
<meta property="og:description" content="Introduction   spaCy is a library for Natural Language Processing (NLP) in python. It offers multiple solutions for text processing such as tokenization, named entity recognition, word vectors, part of speech tagging." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nasseralkmim.github.io/notes/text-processing-python/" /><meta property="article:section" content="notes" />
<meta property="article:published_time" content="2020-12-09T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-12-09T00:00:00&#43;00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Text processing with spaCy"/>
<meta name="twitter:description" content="Introduction   spaCy is a library for Natural Language Processing (NLP) in python. It offers multiple solutions for text processing such as tokenization, named entity recognition, word vectors, part of speech tagging."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://nasseralkmim.github.io/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css" integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://nasseralkmim.github.io/images/favicon.ico" />

  
  
  
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74704246-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://nasseralkmim.github.io/">
  
    <div id="logo" style="background-image: url(https://nasseralkmim.github.io/images/logo.png)"></div>
  
  <div id="title">
    <h1>Notes</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="Menu"><i class="fas fa-bars fa-2x" aria-hidden="true"></i></a>
      </li>
      
        <li><a href="/">home</a></li>
      
        <li><a href="/notes">notes</a></li>
      
        <li><a href="/tags">tags</a></li>
      
        <li><a href="/about">about</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Introduction
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
spaCy is a library for Natural Language Processing (NLP) in python.
It offers multiple solutions for text processing such as tokenization, named entity recognition, word vectors, part of speech tagging.
The alternative is the library NLTK which seems to be used mostly in academia whereas spaCy is recommended for production use.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Load the language model
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>We need to download the models for the language with <code class="verbatim">python -m spacy download model-name.</code>
Then we can load the language model in our code by creating a <code class="verbatim">Language</code> object.
This object has all the data and methods required to process the text.
By calling this object on a string of text we get a processed object <code class="verbatim">Doc</code>, which is a sequence of <code class="verbatim">Token</code> objects.
The <code class="verbatim">Doc</code> object has a <code class="verbatim">__getitem__()</code> method which enabled the container to be accessed like a list.</p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">spacy</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>nlp <span style="color:#666">=</span> spacy<span style="color:#666">.</span>load(<span style="color:#b44">&#39;pt_core_news_sm&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>text <span style="color:#666">=</span> <span style="color:#b44">&#34;&#34;&#34;Joaquim Maria Machado de Assis (Rio de Janeiro, 21 de junho de
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span style="color:#b44">1839 — Rio de Janeiro, 29 de setembro de 1908) foi um escritor
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#b44">brasileiro, considerado por muitos críticos, estudiosos, escritores e
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span style="color:#b44">leitores um dos maiores senão o maior nome da literatura do Brasil.&#34;&#34;&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>doc <span style="color:#666">=</span> nlp(text)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span style="color:#a2f;font-weight:bold">print</span>(doc, <span style="color:#a2f">type</span>(doc))</code></pre></div>
</div>
<pre class="example">
Joaquim Maria Machado de Assis (Rio de Janeiro, 21 de junho de
1839 — Rio de Janeiro, 29 de setembro de 1908) foi um escritor
brasileiro, considerado por muitos críticos, estudiosos, escritores e
leitores um dos maiores senão o maior nome da literatura do Brasil. &lt;class &#39;spacy.tokens.doc.Doc&#39;&gt;
</pre>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Tokenization
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>
When the string is processed into <code class="verbatim">Doc</code> spaCy automatically tokenizes the text.
Which is the process of dividing the text in individual entities.</p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#a2f;font-weight:bold">for</span> token <span style="color:#a2f;font-weight:bold">in</span> doc[:<span style="color:#666">10</span>]:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>    <span style="color:#a2f;font-weight:bold">print</span>(token<span style="color:#666">.</span>text)</code></pre></div>
</div>
<pre class="example">
Joaquim
Maria
Machado
de
Assis
(
Rio
de
Janeiro
,
</pre>
<p>
We can see it considers already punctuation rules.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Part of speech (POS)
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>
Part of speech tagging is a process in which we want to know what word type our tokens are.
The model loaded was trained to be capable of associate words to its type.
We need to use <code class="verbatim">token.pos_</code> in order to get a readable string.</p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#a2f;font-weight:bold">for</span> token <span style="color:#a2f;font-weight:bold">in</span> doc[:<span style="color:#666">10</span>]:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>    <span style="color:#a2f;font-weight:bold">print</span>(token<span style="color:#666">.</span>text, token<span style="color:#666">.</span>pos_)</code></pre></div>
</div>
<pre class="example">
Joaquim PROPN
Maria PROPN
Machado PROPN
de ADP
Assis PROPN
( PUNCT
Rio PROPN
de ADP
Janeiro PROPN
, PUNCT
</pre>
<p>
we can see the types: PROPN (proper noun), ADP (adposition), PUNCT (punctuation).</p>
<p>
spaCy offers a really neat form of displaying the text.</p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>spacy<span style="color:#666">.</span>displacy<span style="color:#666">.</span>render(doc[:<span style="color:#666">5</span>])</code></pre></div>
</div>
<span class="tex2jax_ignore"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:lang="pt" id="4f5594799d994e6689374bbd276acd3b-0" class="displacy" width="925" height="399.5" direction="ltr" style="max-width: none; height: 399.5px; color: #000000; background: #ffffff; font-family: Arial; direction: ltr">
<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="50">Joaquim</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="50">PROPN</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="225">Maria</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="225">PROPN</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="400">Machado</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="400">PROPN</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="575">de</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="575">ADP</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="750">Assis</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="750">PROPN</tspan>
</text>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-4f5594799d994e6689374bbd276acd3b-0-0" stroke-width="2px" d="M70,264.5 C70,177.0 215.0,177.0 215.0,264.5" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-4f5594799d994e6689374bbd276acd3b-0-0" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">flat:name</textPath>
    </text>
    <path class="displacy-arrowhead" d="M215.0,266.5 L223.0,254.5 207.0,254.5" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-4f5594799d994e6689374bbd276acd3b-0-1" stroke-width="2px" d="M70,264.5 C70,89.5 395.0,89.5 395.0,264.5" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-4f5594799d994e6689374bbd276acd3b-0-1" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">flat:name</textPath>
    </text>
    <path class="displacy-arrowhead" d="M395.0,266.5 L403.0,254.5 387.0,254.5" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-4f5594799d994e6689374bbd276acd3b-0-2" stroke-width="2px" d="M595,264.5 C595,177.0 740.0,177.0 740.0,264.5" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-4f5594799d994e6689374bbd276acd3b-0-2" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">case</textPath>
    </text>
    <path class="displacy-arrowhead" d="M595,266.5 L587,254.5 603,254.5" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-4f5594799d994e6689374bbd276acd3b-0-3" stroke-width="2px" d="M70,264.5 C70,2.0 750.0,2.0 750.0,264.5" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-4f5594799d994e6689374bbd276acd3b-0-3" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">nmod</textPath>
    </text>
    <path class="displacy-arrowhead" d="M750.0,266.5 L758.0,254.5 742.0,254.5" fill="currentColor"/>
</g>
</svg></span>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
Named entity recognition (NER)
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>The NER process aims to identify entities that represent something in reality (e.g. person, city, date).
The attribute <code class="verbatim">doc.ents</code> are the named entities as a tuple.</p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#a2f;font-weight:bold">for</span> ent <span style="color:#a2f;font-weight:bold">in</span> doc<span style="color:#666">.</span>ents:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>    <span style="color:#a2f;font-weight:bold">print</span>(ent<span style="color:#666">.</span>text, ent<span style="color:#666">.</span>label_)</code></pre></div>
</div>
<pre class="example">
Joaquim Maria Machado de Assis PER
Rio de Janeiro LOC
Rio de Janeiro LOC
Brasil LOC
</pre>
<p>
Very nice and easy.
This result can also be display nicely.</p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>spacy<span style="color:#666">.</span>displacy<span style="color:#666">.</span>render(doc, style<span style="color:#666">=</span><span style="color:#b44">&#39;ent&#39;</span>)</code></pre></div>
</div>
<span class="tex2jax_ignore"><div class="entities" style="line-height: 2.5; direction: ltr">
<mark class="entity" style="background: #ddd; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Joaquim Maria Machado de Assis
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">PER</span>
</mark>
 (
<mark class="entity" style="background: #ff9561; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Rio de Janeiro
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">LOC</span>
</mark>
, 21 de junho de</br>1839 — 
<mark class="entity" style="background: #ff9561; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Rio de Janeiro
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">LOC</span>
</mark>
, 29 de setembro de 1908) foi um escritor</br>brasileiro, considerado por muitos críticos, estudiosos, escritores e</br>leitores um dos maiores senão o maior nome da literatura do 
<mark class="entity" style="background: #ff9561; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Brasil
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">LOC</span>
</mark>
.</div></span>
<p>
As we can see, it didn&#39;t recognize the dates.
We can manually assign those.</p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#a2f;font-weight:bold">print</span>(doc[<span style="color:#666">10</span>:<span style="color:#666">16</span>])
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#a2f;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">spacy.tokens</span> <span style="color:#a2f;font-weight:bold">import</span> Span
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>date_ent <span style="color:#666">=</span> Span(doc, <span style="color:#666">10</span>, <span style="color:#666">16</span>, label<span style="color:#666">=</span><span style="color:#b44">&#39;DATE&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>doc<span style="color:#666">.</span>ents <span style="color:#666">=</span> <span style="color:#a2f">list</span>(doc<span style="color:#666">.</span>ents) <span style="color:#666">+</span> [date_ent] <span style="color:#080;font-style:italic"># add a new ent to the list</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>spacy<span style="color:#666">.</span>displacy<span style="color:#666">.</span>render(doc, style<span style="color:#666">=</span><span style="color:#b44">&#39;ent&#39;</span>)</code></pre></div>
</div>
<pre class="example">
21 de junho de
1839
</pre>
<span class="tex2jax_ignore"><div class="entities" style="line-height: 2.5; direction: ltr">
<mark class="entity" style="background: #ddd; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Joaquim Maria Machado de Assis
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">PER</span>
</mark>
 (
<mark class="entity" style="background: #ff9561; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Rio de Janeiro
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">LOC</span>
</mark>
, 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    21 de junho de
1839
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 — 
<mark class="entity" style="background: #ff9561; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Rio de Janeiro
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">LOC</span>
</mark>
, 29 de setembro de 1908) foi um escritor</br>brasileiro, considerado por muitos críticos, estudiosos, escritores e</br>leitores um dos maiores senão o maior nome da literatura do 
<mark class="entity" style="background: #ff9561; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Brasil
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">LOC</span>
</mark>
.</div></span>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
Conclusion
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<p>
I am very impressed by this tool.
Very high level and easy to use, I&#39;m looking forward to explore it more.</p>
</div>
</div>

  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  © {year} 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">home</a></li>
         
        <li><a href="/notes">notes</a></li>
         
        <li><a href="/tags">tags</a></li>
         
        <li><a href="/about">about</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
