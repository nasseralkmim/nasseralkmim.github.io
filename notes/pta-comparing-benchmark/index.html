<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="../../lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Comparing portfolio returns with benchmark | Notes repository</title>
  <link rel = 'canonical' href = 'https://nasseralkmim.github.io/notes/pta-comparing-benchmark/'>
  <meta name="description" content="This is a page where I collect some of my post-worthy notes and some projects that I have worked on.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Comparing portfolio returns with benchmark" />
<meta property="og:description" content="Introduction In this post I go over an example of computing a portfolio return (TWR) and comparing it each month with a benchmark." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nasseralkmim.github.io/notes/pta-comparing-benchmark/" /><meta property="article:section" content="notes" />
<meta property="article:published_time" content="2024-01-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-07T17:14:47+00:00" />


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Comparing portfolio returns with benchmark"/>
<meta name="twitter:description" content="Introduction In this post I go over an example of computing a portfolio return (TWR) and comparing it each month with a benchmark."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://nasseralkmim.github.io/css/styles.cfcfd5631b3e66ebdd88ed02b4aa0abf7dd0a37899a474cf0c3899ed73e22a4f9a90439c9b3abe475e584ba94a22a965d782682dcfebd485052d0b2358eb891a.css" integrity="sha512-z8/VYxs&#43;ZuvdiO0CtKoKv33Qo3iZpHTPDDiZ7XPiKk&#43;akEOcmzq&#43;R15YS6lKIqll14JoLc/r1IUFLQsjWOuJGg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://nasseralkmim.github.io/images/favicon.ico" />

  
  
  
  
  
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74704246-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
<script src=../../js/toc.js></script>
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="../../">home</a></li>
         
        <li><a href="../../notes">notes</a></li>
         
        <li><a href="../../tags">tags</a></li>
         
        <li><a href="../../about">about</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://nasseralkmim.github.io/notes/pta-computing-returns/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&text=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&title=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&is_video=false&description=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Comparing%20portfolio%20returns%20with%20benchmark&body=Check out this article: https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&title=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&title=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&name=Comparing%20portfolio%20returns%20with%20benchmark&description=Introduction%20In%20this%20post%20I%20go%20over%20an%20example%20of%20computing%20a%20portfolio%20return%20%28TWR%29%20and%20comparing%20it%20each%20month%20with%20a%20benchmark." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&t=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Introduction</a>
</li>
<li><a href="#headline-2">Example</a>
<ul>
<li><a href="#headline-3">Initial portfolio investment</a>
</li>
<li><a href="#headline-4">Market value after a year</a>
</li>
<li><a href="#headline-5">ROI first month</a>
</li>
<li><a href="#headline-6">Roi each month</a>
</li>
<li><a href="#headline-7">ROI end of the year</a>
</li>
<li><a href="#headline-8">Comparing performance to a benchmark</a>
</li>
<li><a href="#headline-9">Using hledger to compute the index return</a>
</li>
<li><a href="#headline-10">Tracking performance over time</a>
</li>
</ul>
</li>
</ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Comparing portfolio returns with benchmark
      </h1>
      <div class="meta">
        
        
        
        
        
        
        
        
        
        <div class="postdate">
          
          <time datetime="2024-01-07 00:00:00 &#43;0000 UTC" itemprop="datePublished">Jan 7 2024</time>
          
            (Updated: <time datetime="2024-01-07 17:14:47 &#43;0000 UTC" itemprop="dateModified">Jan 7 2024</time>)
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          7 minute read
        </div>
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="../../tags/pta" rel="tag">pta</a>
            
        </div>
        
      </div>
    </header>

  
  
  
  
  
  
  
  
  
    
    <div class="content" itemprop="articleBody">
      
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Introduction
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
In this post I go over an example of computing a portfolio return (TWR) and comparing it each month with a benchmark.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Example
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
Initial portfolio investment
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>
Let&#39;s say our portfolio has only one stock.
At the purchase date, the price was</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">yahooquery</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">yq</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">datetime</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>appl <span style="color:#666">=</span> yq<span style="color:#666">.</span>Ticker(<span style="color:#b44">&#39;aapl&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(appl<span style="color:#666">.</span>history(start<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">1</span>,<span style="color:#666">1</span>), end<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">1</span>,<span style="color:#666">4</span>))<span style="color:#666">.</span>close)</span></span></code></pre></div>
</div>
<pre class="example">
symbol  date      
aapl    2023-01-03    125.07
Name: close, dtype: float64
</pre>
<p>
We can register this purchase in our ledger with</p>
<div class="src src-ledger">
<pre tabindex="0"><code class="language-ledger" data-lang="ledger">2023-01-03 * Buy appl
    assets:investments:stocks  1 aapl @ $125.07
    assets:cash</code></pre>
</div>
<p>
Then we can check our portfolio with,</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>hledger -f portfolio.ledger bal acct:investments</span></span></code></pre></div>
</div>
<pre class="example">
              1 aapl  assets:investments:stocks
--------------------
              1 aapl  
</pre>
<p>
How much the portfolio value now, can be computed if we have the price now.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
Market value after a year
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<p>
The stock price fluctuates, and at the end of the year, the value is,</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">yahooquery</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">yq</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">datetime</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>appl <span style="color:#666">=</span> yq<span style="color:#666">.</span>Ticker(<span style="color:#b44">&#39;aapl&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(appl<span style="color:#666">.</span>history(start<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">12</span>,<span style="color:#666">28</span>), end<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">12</span>,<span style="color:#666">31</span>))<span style="color:#666">.</span>close)</span></span></code></pre></div>
</div>
<pre class="example">
symbol  date      
aapl    2023-12-28    193.580002
        2023-12-29    192.529999
Name: close, dtype: float64
</pre>
<p>
We can see, the stock closed December 29th at 192.53.
We can get the stock price each month and record it in the ledger,</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#b8860b">python</span><span style="color:#666">=</span>~/.venv/general/bin/python
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#b8860b">$python</span> -m investory.values --commodity aapl --begin 2023-01-01
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>cat aapl.ledger</span></span></code></pre></div>
</div>
<pre class="example">
P 2023-01-31 &#34;aapl&#34; $143.487961
P 2023-02-28 &#34;aapl&#34; $146.814438
P 2023-03-31 &#34;aapl&#34; $164.233780
P 2023-04-28 &#34;aapl&#34; $168.994476
P 2023-05-31 &#34;aapl&#34; $176.778061
P 2023-06-30 &#34;aapl&#34; $193.453552
P 2023-07-31 &#34;aapl&#34; $195.926956
P 2023-08-31 &#34;aapl&#34; $187.622818
P 2023-09-29 &#34;aapl&#34; $170.984741
P 2023-10-31 &#34;aapl&#34; $170.545319
P 2023-11-30 &#34;aapl&#34; $189.949997
P 2023-12-29 &#34;aapl&#34; $192.529999
</pre>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
ROI first month
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>
Now we want to know the performance of our portfolio.
This means, how much our assets appreciated or depreciated in value.
Of course, without considering contributions and withdrawls to our portfolio.</p>
<p>
With hledger we can obtain the time-weighted return.
For the first month, we get that we started with a cashflow event of 125.07.
This represents the purchase, the <code class="verbatim">value=then</code> can only be obtained because we have <code class="verbatim">--infer-market-price</code> option, which will use the purchase price as market value on this date.</p>
<p>
The TWR for the period is 14.73%.
Which represents the increase in value without considering contributions/withdrawls.
We can check with (/ (- 143.49 125.07) 125.07)0.14727.</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>hledger -f portfolio.ledger -f aapl.ledger roi --inv investments --pnl <span style="color:#b44">&#34;unrealized&#34;</span> --value<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">then</span> --monthly --infer-market-price</span></span></code></pre></div>
</div>
<pre class="example">
+---++------------+------------++---------------+----------+-------------+--------++---------++------------+----------+
|   ||      Begin |        End || Value (begin) | Cashflow | Value (end) |    PnL ||     IRR || TWR/period | TWR/year |
+===++============+============++===============+==========+=============+========++=========++============+==========+
| 1 || 2023-01-01 | 2023-01-31 ||             0 |  $125.07 |     $143.49 | $18.42 || 463.54% ||     14.73% |  404.25% |
+---++------------+------------++---------------+----------+-------------+--------++---------++------------+----------+

</pre>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
Roi each month
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>
We can get the TWR for each month by specifying the end date since we have price directives for each month end.
We can see, some very positive months and some negatives as well.</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>hledger -f portfolio.ledger -f aapl.ledger roi --inv investments --pnl <span style="color:#b44">&#34;unrealized&#34;</span> --value<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">then</span> --monthly --infer-market-price --end<span style="color:#666">=</span>2024-01-01</span></span></code></pre></div>
</div>
<pre class="example">
+-------++------------+------------++---------------+----------+-------------+---------++---------++------------+----------+
|       ||      Begin |        End || Value (begin) | Cashflow | Value (end) |     PnL ||     IRR || TWR/period | TWR/year |
+=======++============+============++===============+==========+=============+=========++=========++============+==========+
|     1 || 2023-01-01 | 2023-01-31 ||             0 |  $125.07 |     $143.49 |  $18.42 || 463.54% ||     14.73% |  404.25% |
|     2 || 2023-02-01 | 2023-02-28 ||       $143.49 |        0 |     $146.81 |   $3.33 ||  34.82% ||      2.32% |   34.85% |
|     3 || 2023-03-01 | 2023-03-31 ||       $146.81 |        0 |     $164.23 |  $17.42 || 274.39% ||     11.86% |  274.20% |
|     4 || 2023-04-01 | 2023-04-30 ||       $164.23 |        0 |     $168.99 |   $4.76 ||  41.58% ||      2.90% |   41.60% |
|     5 || 2023-05-01 | 2023-05-31 ||       $168.99 |        0 |     $176.78 |   $7.78 ||  69.92% ||      4.61% |   70.00% |
|     6 || 2023-06-01 | 2023-06-30 ||       $176.78 |        0 |     $193.45 |  $16.68 || 199.44% ||      9.43% |  199.34% |
|     7 || 2023-07-01 | 2023-07-31 ||       $193.45 |        0 |     $195.93 |   $2.47 ||  16.14% ||      1.28% |   16.15% |
|     8 || 2023-08-01 | 2023-08-31 ||       $195.93 |        0 |     $187.62 |  $-8.30 || -39.95% ||     -4.24% |  -39.96% |
|     9 || 2023-09-01 | 2023-09-30 ||       $187.62 |        0 |     $170.98 | $-16.64 || -67.69% ||     -8.87% |  -67.70% |
|    10 || 2023-10-01 | 2023-10-31 ||       $170.98 |        0 |     $170.55 |  $-0.44 ||  -2.98% ||     -0.26% |   -3.02% |
|    11 || 2023-11-01 | 2023-11-30 ||       $170.55 |        0 |     $189.95 |  $19.40 || 271.02% ||     11.38% |  271.10% |
|    12 || 2023-12-01 | 2023-12-31 ||       $189.95 |        0 |     $192.53 |   $2.58 ||  17.22% ||      1.36% |   17.24% |
+-------++------------+------------++---------------+----------+-------------+---------++---------++------------+----------+
| Total || 2023-01-01 | 2023-12-31 ||             0 |  $125.07 |     $192.53 |  $67.46 ||  54.30% ||     53.94% |   53.94% |
+-------++------------+------------++---------------+----------+-------------+---------++---------++------------+----------+
</pre>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
ROI end of the year
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>
If we multiply the TWR change factor<sup class="footnote-reference"><a id="footnote-reference-1" href="#footnote-1">1</a></sup> for each month, we can get the cummulative return for the year,</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">numpy</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">np</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>monthly_returns_perc <span style="color:#666">=</span> np<span style="color:#666">.</span>array([
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#666">14.73</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    <span style="color:#666">2.32</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    <span style="color:#666">11.86</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    <span style="color:#666">2.90</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    <span style="color:#666">4.61</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    <span style="color:#666">9.43</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    <span style="color:#666">1.28</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    <span style="color:#666">-</span><span style="color:#666">4.24</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    <span style="color:#666">-</span><span style="color:#666">8.87</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    <span style="color:#666">-</span><span style="color:#666">0.26</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    <span style="color:#666">11.38</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    <span style="color:#666">1.36</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>])
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>accumulated_return <span style="color:#666">=</span> np<span style="color:#666">.</span>prod(monthly_returns_perc <span style="color:#666">/</span> <span style="color:#666">100</span> <span style="color:#666">+</span> <span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span><span style="color:#a2f">print</span>(<span style="color:#b44">f</span><span style="color:#b44">&#34;Performance year: </span><span style="color:#b68;font-weight:bold">{</span>(accumulated_return <span style="color:#666">-</span> <span style="color:#666">1</span>)<span style="color:#666">*</span><span style="color:#666">100</span><span style="color:#b68;font-weight:bold">:</span><span style="color:#b44">.2f</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">%&#34;</span>)</span></span></code></pre></div>
</div>
<pre class="example">
Performance year: 53.94%
</pre>
<p>
With hledger we can also obtain this performance by asking for the yearly value,</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>hledger -f portfolio.ledger -f aapl.ledger roi --inv investments --pnl <span style="color:#b44">&#34;unrealized&#34;</span> --value<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">then</span> --yearly --infer-market-price --end<span style="color:#666">=</span>2024-01-01</span></span></code></pre></div>
</div>
<pre class="example">
+---++------------+------------++---------------+----------+-------------+--------++--------++------------+----------+
|   ||      Begin |        End || Value (begin) | Cashflow | Value (end) |    PnL ||    IRR || TWR/period | TWR/year |
+===++============+============++===============+==========+=============+========++========++============+==========+
| 1 || 2023-01-01 | 2023-12-31 ||             0 |  $125.07 |     $192.53 | $67.46 || 54.30% ||     53.94% |   53.94% |
+---++------------+------------++---------------+----------+-------------+--------++--------++------------+----------+

</pre>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Comparing performance to a benchmark
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>
We can compare to a benchmark in many different ways.
One way is to check how much the index grew during the year.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">yahooquery</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">yq</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">datetime</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>spx <span style="color:#666">=</span> yq<span style="color:#666">.</span>Ticker(<span style="color:#b44">&#39;^spx&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(spx<span style="color:#666">.</span>history(start<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">1</span>,<span style="color:#666">1</span>), end<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">1</span>,<span style="color:#666">4</span>))<span style="color:#666">.</span>close)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#a2f">print</span>(spx<span style="color:#666">.</span>history(start<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">12</span>,<span style="color:#666">29</span>), end<span style="color:#666">=</span>datetime<span style="color:#666">.</span>date(<span style="color:#666">2023</span>,<span style="color:#666">12</span>,<span style="color:#666">31</span>))<span style="color:#666">.</span>close)</span></span></code></pre></div>
</div>
<pre class="example">
symbol  date      
^spx    2023-01-03    3824.139893
Name: close, dtype: float64
symbol  date      
^spx    2023-12-29    4769.830078
Name: close, dtype: float64
</pre>
<p>
We can then compute the growth for one share of the index,</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>year_return <span style="color:#666">=</span> (<span style="color:#666">4769.830078</span> <span style="color:#666">-</span> <span style="color:#666">3824.139893</span>) <span style="color:#666">/</span> <span style="color:#666">3824.139893</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(<span style="color:#b44">f</span><span style="color:#b44">&#34;Performance year: </span><span style="color:#b68;font-weight:bold">{</span>(year_return)<span style="color:#666">*</span><span style="color:#666">100</span><span style="color:#b68;font-weight:bold">:</span><span style="color:#b44">.2f</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">%&#34;</span>)</span></span></code></pre></div>
</div>
<pre class="example">
Performance year: 24.73%
</pre>
</div>
</div>
<div id="outline-container-headline-9" class="outline-3">
<h3 id="headline-9">
Using hledger to compute the index return
</h3>
<div id="outline-text-headline-9" class="outline-text-3">
<p>
We can also use hledger to compute the performance of the index for the same period as our portfolio.
With this we can get the same data points as our porfolio.
To do that, we need the a hypotetical portfolio with the index share.</p>
<div class="src src-ledger">
<pre tabindex="0"><code class="language-ledger" data-lang="ledger">2023-01-03 * Benchmark portfolio
    assets:investments:stocks  1 ^spx @ $3824.139893
    assets:cash</code></pre>
</div>
<p>
Then we need the price of the index<sup class="footnote-reference"><a id="footnote-reference-2" href="#footnote-2">2</a></sup> at the end of each month,</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#b8860b">python</span><span style="color:#666">=</span>~/.venv/general/bin/python
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#b8860b">$python</span> -m investory.values --commodity ^spx --begin 2023-01-01
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>cat ^spx.ledger</span></span></code></pre></div>
</div>
<pre class="example">
P 2023-01-31 &#34;^spx&#34; $4076.600098
P 2023-02-28 &#34;^spx&#34; $3970.149902
P 2023-03-31 &#34;^spx&#34; $4109.310059
P 2023-04-28 &#34;^spx&#34; $4169.479980
P 2023-05-31 &#34;^spx&#34; $4179.830078
P 2023-06-30 &#34;^spx&#34; $4450.379883
P 2023-07-31 &#34;^spx&#34; $4588.959961
P 2023-08-31 &#34;^spx&#34; $4507.660156
P 2023-09-29 &#34;^spx&#34; $4288.049805
P 2023-10-31 &#34;^spx&#34; $4193.799805
P 2023-11-30 &#34;^spx&#34; $4567.799805
P 2023-12-29 &#34;^spx&#34; $4769.830078
</pre>
<p>
With this price at the end of each month we can compute the performance monthly or yearly.
Let&#39;s check the yearly change for the index.
We can see that we get the same value as before for the year change.</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>hledger -f benchmark.ledger -f ^spx.ledger roi --inv investments --pnl <span style="color:#b44">&#34;unrealized&#34;</span> --value<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">then</span> --yearly --infer-market-price --end<span style="color:#666">=</span>2024-01-01</span></span></code></pre></div>
</div>
<pre class="example">
+---++------------+------------++---------------+--------------+--------------+-------------++--------++------------+----------+
|   ||      Begin |        End || Value (begin) |     Cashflow |  Value (end) |         PnL ||    IRR || TWR/period | TWR/year |
+===++============+============++===============+==============+==============+=============++========++============+==========+
| 1 || 2023-01-01 | 2023-12-31 ||             0 | $3824.139893 | $4769.830078 | $945.690185 || 24.88% ||     24.73% |   24.73% |
+---++------------+------------++---------------+--------------+--------------+-------------++--------++------------+----------+

</pre>
</div>
</div>
<div id="outline-container-headline-10" class="outline-3">
<h3 id="headline-10">
Tracking performance over time
</h3>
<div id="outline-text-headline-10" class="outline-text-3">
<p>
We can track the performance at the end of each year with a percentage change for the portfolio and index.
Like we did, our portfolio at the year os 2023 grew 53.94% and the index only grew 24.73%.
This means that our allocation of assets (only Apple in this case) in our portolio beat the market (US).</p>
<p>
However would be nice to have a track of performance over time with monthly acummulated returns.
For instance,</p>
<ol>
<li>First month our portfolio increased in 14.73%, then we check how much the index changed this month.</li>
<li>Second month, our portolio increased (* (- (* 1.1473 1.0232) 1) 100)17.39. Which is the accumulated over the two first returns.</li>
</ol>
<p>And repeating for the whole period, plotting the accumulated return each month.</p>
<p>
We can do that by saving the monhthly TWR for the portfolio and for the benchmark,</p>
<div class="src src-sh">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>hledger -f portfolio.ledger -f aapl.ledger roi --inv investments --pnl <span style="color:#b44">&#34;unrealized&#34;</span> --value<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">then</span> --monthly --infer-market-price --end<span style="color:#666">=</span>2024-01-01 &gt; portfolio-twr.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>hledger -f benchmark.ledger -f ^spx.ledger roi --inv investments --pnl <span style="color:#b44">&#34;unrealized&#34;</span> --value<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">then</span> --monthly --infer-market-price --end<span style="color:#666">=</span>2024-01-01 &gt; benchmark-twr.txt</span></span></code></pre></div>
</div>
<p>
Then we can just load that with python and plot the cummulated value,</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">matplotlib.pyplot</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">plt</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">figtex</span>; figtex<span style="color:#666">.</span>style()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">pandas</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">pd</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>files <span style="color:#666">=</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    <span style="color:#b44">&#34;portfolio-twr.txt&#34;</span>: <span style="color:#a2f">dict</span>(label<span style="color:#666">=</span><span style="color:#b44">&#34;portfolio&#34;</span>, linewidth<span style="color:#666">=</span><span style="color:#666">2</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    <span style="color:#b44">&#34;benchmark-twr.txt&#34;</span>: <span style="color:#a2f">dict</span>(label<span style="color:#666">=</span><span style="color:#b44">&#34;S\&amp;P500&#34;</span>, linewidth<span style="color:#666">=</span><span style="color:#666">6</span>, alpha<span style="color:#666">=</span><span style="color:#666">.3</span>, color<span style="color:#666">=</span><span style="color:#b44">&#34;black&#34;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>fig, ax <span style="color:#666">=</span> plt<span style="color:#666">.</span>subplots(figsize<span style="color:#666">=</span>(<span style="color:#666">4</span>, <span style="color:#666">3</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#a2f;font-weight:bold">for</span> file, params <span style="color:#a2f;font-weight:bold">in</span> files<span style="color:#666">.</span>items():
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    <span style="color:#080;font-style:italic"># read the ascii formatted table</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    <span style="color:#080;font-style:italic"># regex: </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    <span style="color:#080;font-style:italic"># \s* matches one or more spaces</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    <span style="color:#080;font-style:italic"># \|\|? matches one or two |</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    df: pd<span style="color:#666">.</span>DataFrame <span style="color:#666">=</span> pd<span style="color:#666">.</span>read_csv(file,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>                                   sep<span style="color:#666">=</span><span style="color:#b44">r</span><span style="color:#b44">&#39;\s*\|\|?\s*&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>                                   skipfooter<span style="color:#666">=</span><span style="color:#666">4</span>, skiprows<span style="color:#666">=</span><span style="color:#666">1</span>, engine<span style="color:#666">=</span><span style="color:#b44">&#39;python&#39;</span>, skipinitialspace<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>    <span style="color:#080;font-style:italic"># remove columns with no data</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    df <span style="color:#666">=</span> df<span style="color:#666">.</span>drop([<span style="color:#b44">&#39;Unnamed: 0&#39;</span>, <span style="color:#b44">&#39;Unnamed: 1&#39;</span>, <span style="color:#b44">&#39;Unnamed: 11&#39;</span>], axis<span style="color:#666">=</span><span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>    <span style="color:#080;font-style:italic"># remove row with no data</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>    df <span style="color:#666">=</span> df<span style="color:#666">.</span>drop([<span style="color:#666">0</span>], axis<span style="color:#666">=</span><span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>    <span style="color:#a2f">print</span>(df)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>    end_dates: pd<span style="color:#666">.</span>Series <span style="color:#666">=</span> pd<span style="color:#666">.</span>to_datetime(df[<span style="color:#b44">&#34;End&#34;</span>], <span style="color:#a2f">format</span><span style="color:#666">=</span><span style="color:#b44">&#34;%Y-%m-</span><span style="color:#b68;font-weight:bold">%d</span><span style="color:#b44">&#34;</span>)<span style="color:#666">.</span>rename(<span style="color:#b44">&#34;end_dates&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>    twr: pd<span style="color:#666">.</span>Series <span style="color:#666">=</span> df[<span style="color:#b44">&#34;TWR/period&#34;</span>]<span style="color:#666">.</span>rename(<span style="color:#b44">&#34;twr&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    twr <span style="color:#666">=</span> twr<span style="color:#666">.</span>str<span style="color:#666">.</span>replace(<span style="color:#b44">&#39;%&#39;</span>, <span style="color:#b44">&#39;&#39;</span>)<span style="color:#666">.</span>astype(<span style="color:#a2f">float</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>    twr <span style="color:#666">=</span> twr <span style="color:#666">/</span> <span style="color:#666">100</span> <span style="color:#666">+</span> <span style="color:#666">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>    <span style="color:#080;font-style:italic"># get the cumulative product which aggregates the result for the period</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>    ax<span style="color:#666">.</span>plot(end_dates<span style="color:#666">.</span>values, twr<span style="color:#666">.</span>cumprod(), <span style="color:#666">**</span>params)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>ax<span style="color:#666">.</span>set(xlabel<span style="color:#666">=</span><span style="color:#b44">&#34;Date&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>       ylabel<span style="color:#666">=</span><span style="color:#b44">&#34;Accumulated TWR&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>ax<span style="color:#666">.</span>legend()</span></span></code></pre></div>
</div>
<p><img src="examples/benchmark/returns.svg" alt="examples/benchmark/returns.svg" title="examples/benchmark/returns.svg" /></p>
<p>
We can see that the S&amp;P500 is larged influenced by the Apple stock movement.</p>
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr class="footnotes-separatator">
<div class="footnote-definitions">
<div class="footnote-definition">
<sup id="footnote-1"><a href="#footnote-reference-1">1</a></sup>
<div class="footnote-body">
<p>(1 + TWR) meaning the change experienced in the period</p>
</div>
</div>
<div class="footnote-definition">
<sup id="footnote-2"><a href="#footnote-reference-2">2</a></sup>
<div class="footnote-body">
<p>In yahoo finance the S&amp;P 500 index ticker is ^SPX <a href="https://finance.yahoo.com/quote/">https://finance.yahoo.com/quote/</a>%5Espx/?guccounter=1 </p>
</div>
</div>
</div>
</div>

    </div>
  </article>

   

<hr />
<h2>See Also</h2>
<ul>
  
  <li><a href="../../notes/pta-computing-returns/">Computing returns with plain text account tools</a></li>
  
</ul>



  
  




  <div class="blog-post-comments">
    
      <div id="disqus_thread">
  <script type="text/javascript">
    (function() {
      
      
      
      
    
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'nasseralkmim';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

    
  </div>



  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="../../">home</a></li>
         
          <li><a href="../../notes">notes</a></li>
         
          <li><a href="../../tags">tags</a></li>
         
          <li><a href="../../about">about</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Introduction</a>
</li>
<li><a href="#headline-2">Example</a>
<ul>
<li><a href="#headline-3">Initial portfolio investment</a>
</li>
<li><a href="#headline-4">Market value after a year</a>
</li>
<li><a href="#headline-5">ROI first month</a>
</li>
<li><a href="#headline-6">Roi each month</a>
</li>
<li><a href="#headline-7">ROI end of the year</a>
</li>
<li><a href="#headline-8">Comparing performance to a benchmark</a>
</li>
<li><a href="#headline-9">Using hledger to compute the index return</a>
</li>
<li><a href="#headline-10">Tracking performance over time</a>
</li>
</ul>
</li>
</ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&text=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&title=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&is_video=false&description=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Comparing%20portfolio%20returns%20with%20benchmark&body=Check out this article: https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&title=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&title=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&name=Comparing%20portfolio%20returns%20with%20benchmark&description=Introduction%20In%20this%20post%20I%20go%20over%20an%20example%20of%20computing%20a%20portfolio%20return%20%28TWR%29%20and%20comparing%20it%20each%20month%20with%20a%20benchmark." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2fpta-comparing-benchmark%2f&t=Comparing%20portfolio%20returns%20with%20benchmark" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2024  Nasser 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="../../">home</a></li>
         
        <li><a href="../../notes">notes</a></li>
         
        <li><a href="../../tags">tags</a></li>
         
        <li><a href="../../about">about</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=../../lib/font-awesome/css/all.min.css>
<script src=../../lib/jquery/jquery.min.js></script>
<script src=../../js/main.js></script>

<script src=../../js/code-copy.js></script>



  


<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script defer language="javascript" type="text/javascript"  src="../../js/dynamic-toc.js"></script>

</html>
