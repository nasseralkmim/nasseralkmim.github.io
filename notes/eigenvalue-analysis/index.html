<!DOCTYPE html>
<html lang="en-us">

<head>
  <title>Eigenvalue analysis | Notes</title>

  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />


  
  
    
 
  
  
  
  
  
  
    
    <link type="text/css" rel="stylesheet" href="/css/post.min.4c5e5ab0d03e404ece7b74443ea2e91e86a9af1b0d56693e939274558f24efdc.css" integrity="sha256-TF5asNA&#43;QE7Oe3REPqLpHoaprxsNVmk&#43;k5J0VY8k79w="/>
  
    
    <link type="text/css" rel="stylesheet" href="/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU="/>
  
  
   
   
    

<script type="application/ld+json">
  
    { 
      "@context": "http://schema.org", 
      "@type": "WebSite", 
      "url": "https:\/\/nasseralkmim.github.io\/notes\/eigenvalue-analysis\/",
      "name": "Eigenvalue analysis",
      "author": {
        "@type": "Person",
        "name": ""
      },
      "description": ""
    }
  
  </script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74704246-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</head>

<body>
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
</div>
 

  <nav class="nav" id="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/">home</a>
      </li>
    
      <li>
        <a  class="active"
         href="/notes">notes</a>
      </li>
    
  </ul>
</nav>


  <main>
    
    

    <div class="flex-wrapper">
      <div class="post__container">
        <div class="post">
          <header class="post__header">
            <h1 id="post__title">Eigenvalue analysis</h1>
            <time datetime="2021-06-09 00:00:00 &#43;0000 UTC" class="post__date">Jun 9 2021</time> 
          </header>
          <article class="post__content">
              

<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Objective?
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<ol>
<li>
<p>find the eigenvalues of the system matrix during the solution procedure of a specific nonlinear problem.</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Expected results?
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<ol>
<li>
<p>eigenvalue evolution for each nodes (average of displacement) plotted as contour using paraview.</p>
</li>
<li>
<p>condition number evolution through time steps.</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Why?
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>The condition number is related to convergence properties of Krylov subspace methods.</p>
<p>
Preconditioning improves convergence by clustering eigenvalues and hence reduces the condition number.</p>
<p>
If we know how the nonlinear behavior affects the eigenvalues we can use this information in the preconditioning process.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Methods?
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
Strategy
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<ol>
<li>
<p>setup a simple test problem in edelweissFE.</p>
</li>
<li>
<p>implement the function to compute the eigenvalue of the system matrix after each Newton step (outer).</p>
</li>
<li>
<p>implement a visualization routine</p>
<ol>
<li>
<p>eigenvalue as nodal value (average between dofs)</p>
</li>
<li>
<p>eigenvalue condition number (max/min) over time step</p>
</li>
</ol>
</li>
<li>
<p>run analysis on more elaborate.</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
Python library to compute eigenvalues
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>
Numpy has a <code class="verbatim">linalg.eigvals(a)</code> function that computes the eigenvalues of a general matrix.
The eigenvalues are returned in the same order they appear in matrix. </p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">numpy</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">np</span>

D = np.diag((<span style="color:#00d;font-weight:bold">19</span>, <span style="color:#00d;font-weight:bold">17</span>, <span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">3</span>, <span style="color:#00d;font-weight:bold">2</span>))
eigvals = np.linalg.eigvals(D)
<span style="color:#080;font-weight:bold">print</span>(eigvals)</code></pre></div>
</div>
<pre class="example">
[19. 17.  1.  3.  2.]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-7" class="outline-2">
<h2 id="headline-7">
Running edelweissFE
</h2>
<div id="outline-text-headline-7" class="outline-text-2">
<p>
<code class="verbatim">edelweissfe</code> is an alias to <code class="verbatim">python</code> in the correct environment and to the <code class="verbatim">edelweissfe.py</code> script.</p>
<div class="src src-shell">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#038">cd</span> simple-test
edelweissfe simple.inp</code></pre></div>
</div>
<pre class="example">
 total size of eq. system: 24                                                                feCore 
+--------------------------------------------------------------------------------------------------+
   Converting elSet all to a nSet due to requested nodal results                       displacement 
   Using 12 threads                                                                     NISTPSolver 
+--------------------------------------------------------------------------------------------------+
   increment 0: 0.000000, 0.000000; time   0.000000 to   0.000000                       NISTPSolver 
           displacement                                                                 NISTPSolver 
      ||R||∞      ||ddU||∞                                                              NISTPSolver 
      0.00e+00✓   0.00e+00✓                                                             NISTPSolver 
   Converged in 1 iteration(s)                                                          NISTPSolver 
   sig22, elementResult: [-0.]                                                              Monitor 
+--------------------------------------------------------------------------------------------------+
   increment 1: 1.000000, 1.000000; time   0.000000 to   1.000000                       NISTPSolver 
           displacement                                                                 NISTPSolver 
      ||R||∞      ||ddU||∞                                                              NISTPSolver 
      0.00e+00✓   0.00e+00✓                                                             NISTPSolver 
   Converged in 1 iteration(s)                                                          NISTPSolver 
   sig22, elementResult: [-0.]                                                              Monitor 
   +-------------------------------------+-------------------------------------+        NISTPSolver 
   |Time in elements                     |     0.0097s                         |        NISTPSolver 
   |Time in distributed loads            |     0.0001s                         |        NISTPSolver 
   |Time in body forces                  |     0.0000s                         |        NISTPSolver 
   |Time in constraints                  |     0.0000s                         |        NISTPSolver 
   |Time in dirichlet R                  |     0.0001s                         |        NISTPSolver 
   |Time in CSR generation               |     0.0004s                         |        NISTPSolver 
   |Time in dirichlet K                  |     0.0001s                         |        NISTPSolver 
   |Time in linear solve                 |     0.0108s                         |        NISTPSolver 
   |Time in convergence check            |     0.0003s                         |        NISTPSolver 
   +-------------------------------------+-------------------------------------+        NISTPSolver 
 +--------------------------------------+--------------------------------------+                  feCore 
 |Step computation time                 |    0.0859s                           |                  feCore 
 +--------------------------------------+--------------------------------------+                  feCore 
   Using 12 threads                                                                          NISTPSolver 
+-------------------------------------------------------------------------------------------------------+
   increment 0: 0.000000, 0.000000; time   1.000000 to   1.000000                            NISTPSolver 
           displacement                                                                      NISTPSolver 
      ||R||∞      ||ddU||∞                                                                   NISTPSolver 
      0.00e+00✓   0.00e+00✓                                                                  NISTPSolver 
   Converged in 1 iteration(s)                                                               NISTPSolver 
   skipping output for zero-increment in step 2                                           Ensight Export 
   sig22, elementResult: [-0.]                                                                   Monitor 
+-------------------------------------------------------------------------------------------------------+
   increment 1: 1.000000, 1.000000; time   1.000000 to   2.000000                            NISTPSolver 
           displacement                                                                      NISTPSolver 
      ||R||∞      ||ddU||∞                                                                   NISTPSolver 
      7.17e-16✓   1.00e-02                                                                   NISTPSolver 
      2.64e-16✓   2.48e-18✓                                                                  NISTPSolver 
   Converged in 2 iteration(s)                                                               NISTPSolver 
   sig22, elementResult: [1800.]                                                                 Monitor 
   +---------------------------------------+---------------------------------------+         NISTPSolver 
   |Time in elements                       |     0.0071s                           |         NISTPSolver 
   |Time in distributed loads              |     0.0001s                           |         NISTPSolver 
   |Time in body forces                    |     0.0000s                           |         NISTPSolver 
   |Time in constraints                    |     0.0000s                           |         NISTPSolver 
   |Time in dirichlet R                    |     0.0001s                           |         NISTPSolver 
   |Time in CSR generation                 |     0.0006s                           |         NISTPSolver 
   |Time in dirichlet K                    |     0.0001s                           |         NISTPSolver 
   |Time in linear solve                   |     0.0066s                           |         NISTPSolver 
   |Time in convergence check              |     0.0006s                           |         NISTPSolver 
   +---------------------------------------+---------------------------------------+         NISTPSolver 
 +-----------------------------------------+-----------------------------------------+                 feCore 
 |Step computation time                    |    0.0456s                              |                 feCore 
 +-----------------------------------------+-----------------------------------------+                 feCore 
 |Job computation time                       |    0.1315s                                |                  feCore 
 +-------------------------------------------+-------------------------------------------+                  feCore
</pre>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Checking
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<div class="src src-shell">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">paraview.exe simple-test/test.case</code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-2">
<h2 id="headline-9">
Results
</h2>
<div id="outline-text-headline-9" class="outline-text-2">
<div id="outline-container-headline-10" class="outline-3">
<h3 id="headline-10">
Simple example
</h3>
<div id="outline-text-headline-10" class="outline-text-3">
<div id="outline-container-headline-11" class="outline-4">
<h4 id="headline-11">
Description
</h4>
<div id="outline-text-headline-11" class="outline-text-4">
<p>Single element with 8 nodes and 3 degrees of freedom per node.</p>
<img src="Results/2021-06-09_16-24-37_screenshot.png" alt="Results/2021-06-09_16-24-37_screenshot.png" title="Results/2021-06-09_16-24-37_screenshot.png" width="350px"/>
</div>
</div>
<div id="outline-container-headline-12" class="outline-4">
<h4 id="headline-12">
Reading the eigenvalues
</h4>
<div id="outline-text-headline-12" class="outline-text-4">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">numpy</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">np</span>

time_step = [<span style="color:#00d;font-weight:bold">0</span>, <span style="color:#00d;font-weight:bold">1</span>]
eigvals = []
<span style="color:#080;font-weight:bold">for</span> i <span style="color:#080">in</span> time_step:
    eigvals.append(np.load(f<span style="color:#d20;background-color:#fff0f0">&#34;simple-test/eigenvalues_{i}.npy&#34;</span>))
<span style="color:#080;font-weight:bold">print</span>(eigvals)</code></pre></div>
</div>
<pre class="example">
[array([1.23811313e+03, 7.05151972e+02, 6.68982435e+02, 6.48173861e+02,
       5.73026612e+02, 1.98781798e+01, 5.13089800e+01, 7.07402572e+01,
       1.28163962e+02, 1.58758348e+02, 1.67894112e+02, 2.42820965e+02,
       2.76313008e+02, 3.66106570e+02, 4.85038681e+02, 4.44600300e+02,
       4.23546899e+02, 1.00000000e+00, 1.00000000e+00, 1.00000000e+00,
       1.00000000e+00, 1.00000000e+00, 1.00000000e+00, 1.00000000e+00]), array([1.14180987e+03, 6.85802817e+02, 6.39536508e+02, 2.09685217e+01,
       5.80573221e+01, 1.19868895e+02, 1.60609754e+02, 2.44274278e+02,
       4.99719600e+02, 3.22140204e+02, 3.68852459e+02, 4.31019322e+02,
       4.06872066e+02, 1.00000000e+00, 1.00000000e+00, 1.00000000e+00,
       1.00000000e+00, 1.00000000e+00, 1.00000000e+00, 1.00000000e+00,
       1.00000000e+00, 1.00000000e+00, 1.00000000e+00, 1.00000000e+00])]
</pre>
</div>
</div>
<div id="outline-container-headline-13" class="outline-4">
<h4 id="headline-13">
System matrix heatmap
</h4>
<div id="outline-text-headline-13" class="outline-text-4">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">seaborn</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">sns</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>

<span style="color:#080;font-weight:bold">for</span> i <span style="color:#080">in</span> time_step:
    fig, ax = plt.subplots() 
    sns.heatmap(np.diag(eigvals[<span style="color:#00d;font-weight:bold">0</span>]))</code></pre></div>
</div>
<p><img src="./jupyter/02d779bde78699a03c61b83f7f3cbec563842207.png" alt="./jupyter/02d779bde78699a03c61b83f7f3cbec563842207.png" title="./jupyter/02d779bde78699a03c61b83f7f3cbec563842207.png" />
<img src="./jupyter/02d779bde78699a03c61b83f7f3cbec563842207.png" alt="./jupyter/02d779bde78699a03c61b83f7f3cbec563842207.png" title="./jupyter/02d779bde78699a03c61b83f7f3cbec563842207.png" /></p>
</div>
</div>
<div id="outline-container-headline-14" class="outline-4">
<h4 id="headline-14">
Eigenvalues as nodal scalar field
</h4>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-15" class="outline-2">
<h2 id="headline-15">
References
</h2>
<div id="outline-text-headline-15" class="outline-text-2">
<ul>
<li>
<p>Elman, H. C., Silvester, D. J., &amp; Wathen, A. J. (). Finite elements
and fast iterative solvers: with applications in incompressible
fluid dynamics. : Oxford University Press.</p>
</li>
</ul>
</div>
</div>


              
                  

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>
              
          </article>
          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="https://nasseralkmim.github.io/tags/python/">python</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="https://nasseralkmim.github.io/tags/linear-algebra/">linear algebra</a>
    </li></ul>

 <div class="pagination">
  
    <a class="pagination__item" href="https://nasseralkmim.github.io/notes/qr-decomposition/">
        <span class="pagination__label">Previous Post</span>
        <span class="pagination__title">QR Decomposition in one image</span>
    </a>
  

  
</div>

          <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "nasseralkmim" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          <footer class="post__footer">
            


<div class="social-icons">
  
     
    
      <a class="social-icons__link" rel="me" title="Email"
         href="mailto:nasser.alkmim@gmail.com"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://nasseralkmim.github.io/svg/email.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="LinkedIn"
         href="https://www.linkedin.com/in/nasser-alkmim-300882a6/"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://nasseralkmim.github.io/svg/linkedin.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="GitHub"
         href="https://github.com/nasseralkmim"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://nasseralkmim.github.io/svg/github.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="Instagram"
         href="https://instagram.com/naszr"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('https://nasseralkmim.github.io/svg/instagram.svg')"></div>
      </a>
    
     
</div>

            <p>© 2021</p>
          </footer>
          </div>
      </div>
      
      <div class="toc-container">
           <div class="toc-post-title">Eigenvalue analysis</div> 
        <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Objective?</a>
</li>
<li><a href="#headline-2">Expected results?</a>
</li>
<li><a href="#headline-3">Why?</a>
</li>
<li><a href="#headline-4">Methods?</a>
<ul>
<li><a href="#headline-5">Strategy</a>
</li>
<li><a href="#headline-6">Python library to compute eigenvalues</a>
</li>
</ul>
</li>
<li><a href="#headline-7">Running edelweissFE</a>
<ul>
<li><a href="#headline-8">Checking</a>
</li>
</ul>
</li>
<li><a href="#headline-9">Results</a>
<ul>
<li><a href="#headline-10">Simple example</a>
<ul>
<li><a href="#headline-11">Description</a>
</li>
<li><a href="#headline-12">Reading the eigenvalues</a>
</li>
<li><a href="#headline-13">System matrix heatmap</a>
</li>
<li><a href="#headline-14">Eigenvalues as nodal scalar field</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#headline-15">References</a>
</li>
</ul>
</nav>
      </div>
      
    </div>
    

  </main>

   

  
  <script src="/js/index.min.575dda8d49ee02639942c63564273e6da972ab531dda26a08800bdcb477cbd7f.js" integrity="sha256-V13ajUnuAmOZQsY1ZCc&#43;balyq1Md2iagiAC9y0d8vX8=" crossorigin="anonymous"></script>
  
  
  

  
  
  

  
    <script src="/js/table-of-contents.js"></script>
  


</body>

</html>
