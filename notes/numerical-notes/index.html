<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>Numerical analysis notes | Notes</title>

  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />


  
  
    
 
  
  
  
  
  
  
    
    <link type="text/css" rel="stylesheet" href="/css/post.min.9184109084ab0858f4d61e201ec74c667f1e039aaddd71fb8204359b0bae18a1.css" integrity="sha256-kYQQkISrCFj01h4gHsdMZn8eA5qt3XH7ggQ1mwuuGKE="/>
  
    
    <link type="text/css" rel="stylesheet" href="/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU="/>
  
  
   
   
    

<script type="application/ld+json">
  
    { 
      "@context": "http://schema.org", 
      "@type": "WebSite", 
      "url": "http:\/\/localhost:1313\/notes\/numerical-notes\/",
      "name": "Numerical analysis notes",
      "author": {
        "@type": "Person",
        "name": ""
      },
      "description": ""
    }
  
  </script>
</head>

<body>
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
</div>
 

  <nav class="nav" id="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/">about</a>
      </li>
    
      <li>
        <a  class="active"
         href="/notes">notes</a>
      </li>
    
  </ul>
</nav>


  <main>
    
    

    <div class="flex-wrapper">
      <div class="post__container">
        <div class="post">
          <header class="post__header">
            <h1 id="post__title">Numerical analysis notes</h1>
            <time datetime="2021-06-30 00:00:00 &#43;0000 UTC" class="post__date">Jun 30 2021</time> 
	    
	    <time datetime="2021-07-16 07:48:29 &#43;0000 UTC" class="post__date">
	      → edited in Jul 16 2021
	    </time>
	    
          </header>
          <article class="post__content">
              

<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Fixed point methods
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
Definition
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<p>From an approximation attempt based on the split of the matrix.</p>
<img src="images/Fixed_point_methods/2021-07-10_09-20-36_screenshot.png" alt="images/Fixed_point_methods/2021-07-10_09-20-36_screenshot.png" title="images/Fixed_point_methods/2021-07-10_09-20-36_screenshot.png" width="550px"/>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
General implementation
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>Relation between fixed-point iteration and preconditioning.</p>
<img src="images/Fixed_point_methods/2021-07-10_09-44-01_screenshot.png" alt="images/Fixed_point_methods/2021-07-10_09-44-01_screenshot.png" title="images/Fixed_point_methods/2021-07-10_09-44-01_screenshot.png" width="550px"/>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">numpy</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">np</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">smoother</span>(A, b, x, Q, n=<span style="color:#00d;font-weight:bold">100</span>, tol=<span style="color:#00d;font-weight:bold">1e-12</span>):
    residual, residuals, iter_counter, I = <span style="color:#00d;font-weight:bold">1</span>, [], <span style="color:#00d;font-weight:bold">0</span>, np.identity(A.shape[<span style="color:#00d;font-weight:bold">0</span>])
    <span style="color:#080;font-weight:bold">while</span> residual &gt; tol:
        x = (I - Q <span style="color:#a61717;background-color:#e3d2d2">@</span> A) <span style="color:#a61717;background-color:#e3d2d2">@</span> x + Q <span style="color:#a61717;background-color:#e3d2d2">@</span> b
        iter_counter += <span style="color:#00d;font-weight:bold">1</span>
        <span style="color:#080;font-weight:bold">if</span> iter_counter == n:
            <span style="color:#080;font-weight:bold">break</span>
        residual = np.linalg.norm(b - A <span style="color:#a61717;background-color:#e3d2d2">@</span> x)
        residuals.append(residual)
    <span style="color:#080;font-weight:bold">return</span> x, iter_counter, residuals</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
Jacobi
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib</span>
matplotlib.style.use(<span style="color:#d20;background-color:#fff0f0">&#39;ggplot&#39;</span>)

A = np.array([[<span style="color:#00d;font-weight:bold">9</span>, <span style="color:#00d;font-weight:bold">2</span>], [<span style="color:#00d;font-weight:bold">3</span>, <span style="color:#00d;font-weight:bold">5</span>]])
b = A[:, <span style="color:#00d;font-weight:bold">0</span>]
x = b * <span style="color:#00d;font-weight:bold">0</span>
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;A={A}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;b={b}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Exact sol: {np.linalg.solve(A, b)}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Exact sol: {np.linalg.solve(A, b)}&#39;</span>)
Q = np.diagflat(np.diag(A)) <span style="color:#888"># </span>
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Q^-1={Q}&#39;</span>)
x, i, r = smoother(A, b, x, np.linalg.inv(Q), tol=<span style="color:#00d;font-weight:bold">1e-8</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Iter sol: {x} in {i} iterations&#39;</span>)
plt.plot(r);plt.xlabel(<span style="color:#d20;background-color:#fff0f0">&#39;iteration&#39;</span>);plt.ylabel(<span style="color:#d20;background-color:#fff0f0">&#39;residual norm&#39;</span>)</code></pre></div>
</div>
<pre class="example">
A=[[9 2]
 [3 5]]
b=[9 3]
Exact sol: [1. 0.]
Exact sol: [1. 0.]
Q^-1=[[9 0]
 [0 5]]
Iter sol: [1.00000000e+00 1.06546361e-09] in 21 iterations
</pre>
<p><img src="./jupyter/9be5447df271774179144bb59130c021bdb94b84.png" alt="./jupyter/9be5447df271774179144bb59130c021bdb94b84.png" title="./jupyter/9be5447df271774179144bb59130c021bdb94b84.png" /></p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
Gauss Seidel
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib</span>
matplotlib.style.use(<span style="color:#d20;background-color:#fff0f0">&#39;ggplot&#39;</span>)

A = np.array([[<span style="color:#00d;font-weight:bold">9</span>, <span style="color:#00d;font-weight:bold">2</span>], [<span style="color:#00d;font-weight:bold">3</span>, <span style="color:#00d;font-weight:bold">5</span>]])
b = A[:, <span style="color:#00d;font-weight:bold">0</span>]
x = b * <span style="color:#00d;font-weight:bold">0</span>
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;A={A}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;b={b}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Exact sol: {np.linalg.solve(A, b)}&#39;</span>)
Q = (np.diagflat(np.diag(A)) - np.tril(A, -<span style="color:#00d;font-weight:bold">1</span>)) <span style="color:#888"># </span>
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Q^-1={Q}&#39;</span>)
x, i, r = smoother(A, b, x, np.linalg.inv(Q), tol=<span style="color:#00d;font-weight:bold">1e-8</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Iter sol: {x} in {i} iterations&#39;</span>)
plt.plot(r);plt.xlabel(<span style="color:#d20;background-color:#fff0f0">&#39;iteration&#39;</span>);plt.ylabel(<span style="color:#d20;background-color:#fff0f0">&#39;residual norm&#39;</span>)</code></pre></div>
</div>
<pre class="example">
A=[[9 2]
 [3 5]]
b=[9 3]
Exact sol: [1. 0.]
Q^-1=[[ 9  0]
 [-3  5]]
Iter sol: [1.00000000e+00 1.11835052e-09] in 39 iterations
</pre>
<p><img src="./jupyter/b94ea0147e5654c6bce7e218e0864e94511e8bc3.png" alt="./jupyter/b94ea0147e5654c6bce7e218e0864e94511e8bc3.png" title="./jupyter/b94ea0147e5654c6bce7e218e0864e94511e8bc3.png" /></p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
QR decomposition
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
Definition
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>
Goal is to find the decomposition of $A=QR$.
Where $Q$ is a orthonormal basis for $A$ and $R$ is a triangular matrix with the &#34;orthogonalization&#34; components.</p>
<img src="Krylov_subspace_methods/2021-07-06_11-53-23_screenshot.png" alt="Krylov_subspace_methods/2021-07-06_11-53-23_screenshot.png" title="Krylov_subspace_methods/2021-07-06_11-53-23_screenshot.png" width="500px"/>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Implementation
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#b06;font-weight:bold">typing</span> <span style="color:#080;font-weight:bold">import</span> Union
<span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">numpy</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">np</span>
np.set_printoptions(<span style="color:#00d;font-weight:bold">2</span>)

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">qr</span>(A: np.ndarray) -&gt; Union[np.ndarray, np.ndarray]:
    <span style="color:#d20;background-color:#fff0f0">&#34;&#34;&#34;Performs A=QR decomposition on A square.&#34;&#34;&#34;</span>
    n, _ = A.shape
    R, Q = np.zeros((n, n)), np.zeros((n, n))
    <span style="color:#080;font-weight:bold">for</span> i <span style="color:#080">in</span> <span style="color:#038">range</span>(n):              <span style="color:#888"># for each column (0, n)</span>
        R[i, i] = np.linalg.norm(A[:, i]) <span style="color:#888"># diagonal entries of R matrix</span>
        Q[:, i] = A[:, i] / R[i, i]       <span style="color:#888"># first basis vector</span>
        <span style="color:#080;font-weight:bold">for</span> j <span style="color:#080">in</span> <span style="color:#038">range</span>(i, n):       <span style="color:#888"># upper triangular</span>
            R[i, j] = Q[:, i] <span style="color:#a61717;background-color:#e3d2d2">@</span> A[:, j]   <span style="color:#888"># non-diagonal entries</span>
            A[:, j] = A[:, j] - R[i, j] * Q[:, i] <span style="color:#888"># remove non orthogonal part (Gram-Schimidt)</span>
    <span style="color:#080;font-weight:bold">return</span> Q, R</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-3">
<h3 id="headline-9">
Simple example
</h3>
<div id="outline-text-headline-9" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>
A = np.array([[<span style="color:#00d;font-weight:bold">12</span>, -<span style="color:#00d;font-weight:bold">51</span>, <span style="color:#00d;font-weight:bold">4</span>], [<span style="color:#00d;font-weight:bold">6</span>, <span style="color:#00d;font-weight:bold">167</span>, -<span style="color:#00d;font-weight:bold">68</span>], [-<span style="color:#00d;font-weight:bold">4</span>, <span style="color:#00d;font-weight:bold">24</span>, -<span style="color:#00d;font-weight:bold">41</span>]])
npq, npr = np.linalg.qr(A)
Q, R = qr(A)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Q=</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0"> {Q} </span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0"> R=</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0">{R}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;numpy: </span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0"> Q=</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0">{npq} </span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0"> R=</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0">{npr}&#39;</span>)
plt.imshow(R)</code></pre></div>
</div>
<pre class="example">
Q=
 [[ 0.86 -0.39 -0.32]
 [ 0.43  0.9   0.03]
 [-0.29  0.17 -0.95]] 
 R=
[[ 14.   21.  -14. ]
 [  0.  175.  -70. ]
 [  0.    0.   34.8]]
numpy: 
 Q=
[[-0.86  0.39  0.33]
 [-0.43 -0.9  -0.03]
 [ 0.29 -0.17  0.94]] 
 R=
[[ -14.  -21.   14.]
 [   0. -175.   70.]
 [   0.    0.  -35.]]
</pre>
<p><img src="./jupyter/cc7779dc587ee0ab9d27dc22cf01d0ca8a6abaf7.png" alt="./jupyter/cc7779dc587ee0ab9d27dc22cf01d0ca8a6abaf7.png" title="./jupyter/cc7779dc587ee0ab9d27dc22cf01d0ca8a6abaf7.png" /></p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-3">
<h3 id="headline-10">
QR and symmetric matrices
</h3>
<div id="outline-text-headline-10" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib</span>
matplotlib.style.use(<span style="color:#d20;background-color:#fff0f0">&#39;ggplot&#39;</span>)

size = <span style="color:#00d;font-weight:bold">10</span>
np.random.seed(<span style="color:#00d;font-weight:bold">2</span>)
A = np.random.random((size, size))
As= A.T <span style="color:#a61717;background-color:#e3d2d2">@</span> A
Q, R = qr(As)
fig, (ax1, ax2) = plt.subplots(<span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">2</span>)
ax1.imshow(R)
ax1.set_title(<span style="color:#d20;background-color:#fff0f0">&#39;Symm&#39;</span>)

Q, R = qr(A)
ax2.imshow(R)
ax2.set_title(<span style="color:#d20;background-color:#fff0f0">&#39;Non Symm&#39;</span>)</code></pre></div>
</div>
<p><img src="./jupyter/20b18d7f46a33ad58a6cfd6393a6d2f588439a97.png" alt="./jupyter/20b18d7f46a33ad58a6cfd6393a6d2f588439a97.png" title="./jupyter/20b18d7f46a33ad58a6cfd6393a6d2f588439a97.png" /></p>
<p>
Remarks:</p>
<ol>
<li>
<p>the triangular matrix has large value at the top.</p>
</li>
<li>
<p>the orthogonalization process has <strong>lower recurrence</strong>, we only need to subtract the from the basis candidate the projection of a few other basis. </p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
Backward and forward substitution
</h3>
<div id="outline-text-headline-11" class="outline-text-3">
<img src="images/QR_decomposition/2021-07-09_14-20-51_screenshot.png" alt="images/QR_decomposition/2021-07-09_14-20-51_screenshot.png" title="images/QR_decomposition/2021-07-09_14-20-51_screenshot.png" width="550px"/>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">backward_subs</span>(U: np.ndarray, c: np.ndarray) -&gt; np.ndarray:
    <span style="color:#d20;background-color:#fff0f0">&#34;&#34;&#34;Compute x from Ux=c, with U upper triangular.&#34;&#34;&#34;</span>
    m, n = U.shape
    x = np.zeros(m)
    <span style="color:#888"># from last m to first 0, -1 to convert position to index </span>
    <span style="color:#080;font-weight:bold">for</span> i <span style="color:#080">in</span> <span style="color:#038">range</span>(m-<span style="color:#00d;font-weight:bold">1</span>, -<span style="color:#00d;font-weight:bold">1</span>, -<span style="color:#00d;font-weight:bold">1</span>):
        x[i] = (c[i] - U[i, i + <span style="color:#00d;font-weight:bold">1</span>:] <span style="color:#a61717;background-color:#e3d2d2">@</span> x[i + <span style="color:#00d;font-weight:bold">1</span>:]) / U[i, i]
    <span style="color:#080;font-weight:bold">return</span> x

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">forward_subs</span>(L: np.ndarray, b: np.ndarray) -&gt; np.ndarray:
    <span style="color:#d20;background-color:#fff0f0">&#34;&#34;&#34;Compute c from Lc=b, with L lower triangular.&#34;&#34;&#34;</span>
    m, n = L.shape
    c = np.zeros(m)
    <span style="color:#080;font-weight:bold">for</span> i <span style="color:#080">in</span> <span style="color:#038">range</span>(m):
        c[i] = b[i] - L[i, :i] <span style="color:#a61717;background-color:#e3d2d2">@</span> c[:i]  / L[i, i]
    <span style="color:#080;font-weight:bold">return</span> c

np.random.seed(<span style="color:#00d;font-weight:bold">1</span>)
A = np.random.random((<span style="color:#00d;font-weight:bold">3</span>, <span style="color:#00d;font-weight:bold">3</span>))
<span style="color:#080;font-weight:bold">from</span> <span style="color:#b06;font-weight:bold">scipy.linalg</span> <span style="color:#080;font-weight:bold">import</span> lu
L, U = lu(A, permute_l=True)
b = A[:, <span style="color:#00d;font-weight:bold">0</span>]
c = forward_subs(L, b)
x = backward_subs(U, c)
<span style="color:#080;font-weight:bold">print</span>(x)
<span style="color:#080;font-weight:bold">print</span>(np.linalg.solve(A, b))</code></pre></div>
</div>
<pre class="example">
[ 1. -0.  0.]
[ 1. -0.  0.]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-12" class="outline-2">
<h2 id="headline-12">
Arnoldi iterations
</h2>
<div id="outline-text-headline-12" class="outline-text-2">
<div id="outline-container-headline-13" class="outline-3">
<h3 id="headline-13">
Definition
</h3>
<div id="outline-text-headline-13" class="outline-text-3">
<p>
The Arnoldi iteration uses the same Gram-Schimit idea in the QR.
But it extends the 
But now we want to find $AQ_n = Q_{n+1} \tilde{H}_n$.
For $A$ a square $m \timex m$ matrix.
This is a reduction of a matrix to a <strong>Hessenberg</strong> form.
The algorithm goes is performed column by column and can be stopped whenever.</p>
<p>
We can understand it as generating basis vectors for a Krylov subspace defined by a general vector $b$ and a matrix $A$.</p>
<img src="Krylov_subspace_methods/2021-07-06_11-50-57_screenshot.png" alt="Krylov_subspace_methods/2021-07-06_11-50-57_screenshot.png" title="Krylov_subspace_methods/2021-07-06_11-50-57_screenshot.png" width="500px"/>
</div>
</div>
<div id="outline-container-headline-14" class="outline-3">
<h3 id="headline-14">
Implementation
</h3>
<div id="outline-text-headline-14" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">numpy</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">np</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#b06;font-weight:bold">typing</span> <span style="color:#080;font-weight:bold">import</span> Union

np.set_printoptions(<span style="color:#00d;font-weight:bold">2</span>, suppress=True)

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">arnoldi</span>(A: np.ndarray,
            b: np.ndarray,
            n_max: <span style="color:#038">int</span>) -&gt; Union[np.ndarray, np.ndarray]:
    <span style="color:#d20;background-color:#fff0f0">&#34;&#34;&#34;Arnoldi iteration AQ_n = Q_n+1 H_n.
</span><span style="color:#d20;background-color:#fff0f0">
</span><span style="color:#d20;background-color:#fff0f0">    Args:
</span><span style="color:#d20;background-color:#fff0f0">        A: (m x m) square matrix.
</span><span style="color:#d20;background-color:#fff0f0">        b: (m) vector.
</span><span style="color:#d20;background-color:#fff0f0">        n_max: number of basis.
</span><span style="color:#d20;background-color:#fff0f0">
</span><span style="color:#d20;background-color:#fff0f0">    Returns:
</span><span style="color:#d20;background-color:#fff0f0">        H: (n_max + 1, n_max) Hessenberg matrix.
</span><span style="color:#d20;background-color:#fff0f0">        Q: (m, n_max + 1) matrix with orthogonal basis.
</span><span style="color:#d20;background-color:#fff0f0">    &#34;&#34;&#34;</span>
    m = A.shape[<span style="color:#00d;font-weight:bold">0</span>]
    H = np.zeros((n_max + <span style="color:#00d;font-weight:bold">1</span>, n_max))
    Q = np.zeros((m, n_max + <span style="color:#00d;font-weight:bold">1</span>))
    Q[:, <span style="color:#00d;font-weight:bold">0</span>] = b / np.linalg.norm(b)  <span style="color:#888"># (1) first basis vector</span>

    <span style="color:#080;font-weight:bold">for</span> n <span style="color:#080">in</span> <span style="color:#038">range</span>(n_max):  <span style="color:#888"># loop over each basis vector</span>
        v = A <span style="color:#a61717;background-color:#e3d2d2">@</span> Q[:, n]  <span style="color:#888"># (2) basis candidate</span>
        <span style="color:#080;font-weight:bold">for</span> j <span style="color:#080">in</span> <span style="color:#038">range</span>(n + <span style="color:#00d;font-weight:bold">1</span>):  <span style="color:#888"># loop over all previous basis</span>
            H[j, n] = Q[:, j] <span style="color:#a61717;background-color:#e3d2d2">@</span> v  <span style="color:#888"># (3) inner product for projection</span>
            v = v - H[j, n] * Q[:, j]  <span style="color:#888"># (4) ortogonalization</span>
        H[n + <span style="color:#00d;font-weight:bold">1</span>, n] = np.linalg.norm(v)  <span style="color:#888"># (5)</span>
        <span style="color:#080;font-weight:bold">if</span> H[n + <span style="color:#00d;font-weight:bold">1</span>, n] &lt; <span style="color:#00d;font-weight:bold">1e-12</span>:  <span style="color:#888"># arnoldi breakdown</span>
            <span style="color:#080;font-weight:bold">return</span> H, Q  <span style="color:#888"># return e exit function</span>
        Q[:, n + <span style="color:#00d;font-weight:bold">1</span>] = v / H[n + <span style="color:#00d;font-weight:bold">1</span>, n]  <span style="color:#888"># (5)</span>
    <span style="color:#080;font-weight:bold">return</span> H, Q</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-15" class="outline-3">
<h3 id="headline-15">
Example
</h3>
<div id="outline-text-headline-15" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">np.random.seed(<span style="color:#00d;font-weight:bold">2</span>)
n = <span style="color:#00d;font-weight:bold">2</span>
A = np.random.random((n, n))
b = np.zeros(A.shape[<span style="color:#00d;font-weight:bold">0</span>]); b[<span style="color:#00d;font-weight:bold">0</span>] = <span style="color:#00d;font-weight:bold">1</span>
H, Q = arnoldi(A, b, n_max=n)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;H: </span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0"> {H}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Q: </span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0"> {Q}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;AQ_n = Q_n+1 H_n?&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;AQ_n =</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0">{A @ Q[:, :n]}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Q_n+1 H_n=</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0">{Q @ H}&#39;</span>)</code></pre></div>
</div>
<pre class="example">
H: 
 [[0.44 0.03]
 [0.55 0.44]
 [0.   0.  ]]
Q: 
 [[1. 0. 0.]
 [0. 1. 0.]]
AQ_n = Q_n+1 H_n?
AQ_n =
[[0.44 0.03]
 [0.55 0.44]]
Q_n+1 H_n=
[[0.44 0.03]
 [0.55 0.44]]
</pre>
</div>
</div>
<div id="outline-container-headline-16" class="outline-3">
<h3 id="headline-16">
Symmetric matrices
</h3>
<div id="outline-text-headline-16" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>
np.random.seed(<span style="color:#00d;font-weight:bold">2</span>)
fig, (ax1, ax2) = plt.subplots(<span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">2</span>)

n = <span style="color:#00d;font-weight:bold">15</span>
A = np.random.random((n, n))
b = np.zeros(A.shape[<span style="color:#00d;font-weight:bold">0</span>]); b[<span style="color:#00d;font-weight:bold">0</span>] = <span style="color:#00d;font-weight:bold">1</span>

As = A.T <span style="color:#a61717;background-color:#e3d2d2">@</span> A
H, Q = arnoldi(As, b, n_max=n)
ax1.imshow(H)
ax1.set_title(<span style="color:#d20;background-color:#fff0f0">&#39;Symm&#39;</span>)

H, Q = arnoldi(A, b, n_max=n)
ax2.imshow(H)
ax2.set_title(<span style="color:#d20;background-color:#fff0f0">&#39;Non Symm&#39;</span>)</code></pre></div>
</div>
<p><img src="./jupyter/2fbad947e2c6112f89ca989ab2274c4869afbc50.png" alt="./jupyter/2fbad947e2c6112f89ca989ab2274c4869afbc50.png" title="./jupyter/2fbad947e2c6112f89ca989ab2274c4869afbc50.png" /></p>
<p>
Remarks:</p>
<ol>
<li>
<p>symmetric matrices implies in lower recurrence since it yields a tridiagonal $H$.</p>
<ol>
<li>
<p>it can optimize the algorithm by not requiring looping over all previous basis, just the immediate previous.</p>
</li>
<li>
<p>tridiagonal because $H$ is Hessenberg and will be symmetric as well.</p>
</li>
</ol>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-17" class="outline-3">
<h3 id="headline-17">
Relation with Kyrlov subspaces
</h3>
<div id="outline-text-headline-17" class="outline-text-3">
<p>
From Strang class.
<a href="https://ocw.mit.edu/courses/mathematics/18-086-mathematical-methods-for-engineers-ii-spring-2006/video-lectures/lecture-18-krylov-methods-multigrid-continued/">Lecture 18: Krylov Methods / Multigrid Continued | Video Lectures | Mathemati…</a></p>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">n = <span style="color:#00d;font-weight:bold">6</span>
krylov_dimension = <span style="color:#00d;font-weight:bold">6</span>

A = np.diagflat(np.arange(<span style="color:#00d;font-weight:bold">1</span>, n+<span style="color:#00d;font-weight:bold">1</span>))
b = np.ones(n)
K = np.empty((n, krylov_dimension))
K[:, <span style="color:#00d;font-weight:bold">0</span>] = b
<span style="color:#080;font-weight:bold">for</span> k <span style="color:#080">in</span> <span style="color:#038">range</span>(<span style="color:#00d;font-weight:bold">1</span>, krylov_dimension):
    K[:, k] = A**k <span style="color:#a61717;background-color:#e3d2d2">@</span> b
<span style="color:#080;font-weight:bold">print</span>(<span style="color:#d20;background-color:#fff0f0">&#39;cond(K): &#39;</span>, np.linalg.cond(K))
H, Q = arnoldi(K, b, n_max=n)
<span style="color:#080;font-weight:bold">print</span>(<span style="color:#d20;background-color:#fff0f0">&#39;cond(Q): &#39;</span>, np.linalg.cond(Q))

fig, ax = plt.subplots()
ax.imshow(H)</code></pre></div>
</div>
<pre class="example">
cond(K):  731200.938786102
cond(Q):  1.4142135623733276
</pre>
<p><img src="./jupyter/da67bec0a1a72539965321a001b7c13fd2be8a67.png" alt="./jupyter/da67bec0a1a72539965321a001b7c13fd2be8a67.png" title="./jupyter/da67bec0a1a72539965321a001b7c13fd2be8a67.png" /></p>
<p>
Remarks:</p>
<ol>
<li>
<p>condition number of the Krylov matrix is very high.</p>
<ol>
<li>
<p>close to singular, columns <strong>almost linearly dependent</strong>.</p>
</li>
<li>
<p>look at $K^T K$, which is symmetric with positive eigenvalues</p>
<ol>
<li>
<p>the Gram matrix measures how independent are the columns vectors.</p>
</li>
</ol>
</li>
<li>
<p>this matrix&#39;s eigenvalues are related to the square of the singular values of $K$</p>
</li>
</ol>
</li>
<li>
<p>condition number of the orthonormal basis of the Krylov subspace is much smaller.</p>
<ol>
<li>
<p>column space vectors are independent</p>
</li>
</ol>
</li>
<li>
<p>the matrix $H$ is concentrated at the top, indicating low recurrence and efficiency of the algorithm.</p>
<ol>
<li>
<p>because less subtractions are required.</p>
</li>
</ol>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-18" class="outline-2">
<h2 id="headline-18">
Least squares
</h2>
<div id="outline-text-headline-18" class="outline-text-2">
<div id="outline-container-headline-19" class="outline-3">
<h3 id="headline-19">
Definition
</h3>
<div id="outline-text-headline-19" class="outline-text-3">
<p>Find an approximation for an overdetermined $Ax=b$ that minimizes the residual norm.</p>
<p>
The problem is that $Ax=b$ has no solution, which means that we can not express $b$ as a linear combination of the columns of $A$.
Then, what we do?
We project $b$ onto $A$ and solve that instead.</p>
<img src="images/Least_squares/2021-07-09_17-00-20_screenshot.png" alt="images/Least_squares/2021-07-09_17-00-20_screenshot.png" title="images/Least_squares/2021-07-09_17-00-20_screenshot.png" width="550px"/>
</div>
</div>
<div id="outline-container-headline-20" class="outline-3">
<h3 id="headline-20">
Implementation
</h3>
<div id="outline-text-headline-20" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">least_square</span>(A: np.ndarray, b: np.ndarray) -&gt; np.ndarray:
    <span style="color:#d20;background-color:#fff0f0">&#34;&#34;&#34;Approximate x for Ax=b
</span><span style="color:#d20;background-color:#fff0f0">
</span><span style="color:#d20;background-color:#fff0f0">    Returns:
</span><span style="color:#d20;background-color:#fff0f0">        x: (n) n is the number of columns of A.
</span><span style="color:#d20;background-color:#fff0f0">    &#34;&#34;&#34;</span>
    Q, R = qr(A.T <span style="color:#a61717;background-color:#e3d2d2">@</span> A)
    x = backward_subs(R, Q.T <span style="color:#a61717;background-color:#e3d2d2">@</span> A.T <span style="color:#a61717;background-color:#e3d2d2">@</span> b)
    <span style="color:#080;font-weight:bold">return</span> x
A = np.array([[<span style="color:#00d;font-weight:bold">1</span>, -<span style="color:#00d;font-weight:bold">2</span>], [<span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">0</span>], [<span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">2</span>]])
b = np.array([<span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">2</span>, <span style="color:#00d;font-weight:bold">4</span>])
x = least_square(A, b)
<span style="color:#080;font-weight:bold">print</span>(x)
npx, _, _, _ = np.linalg.lstsq(A, b, rcond=None)
<span style="color:#080;font-weight:bold">print</span>(npx)</code></pre></div>
</div>
<pre class="example">
[2.33 0.75]
[2.33 0.75]
</pre>
</div>
</div>
<div id="outline-container-headline-21" class="outline-3">
<h3 id="headline-21">
Visualization
</h3>
<div id="outline-text-headline-21" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, ax = plt.subplots()
A = np.array([[<span style="color:#00d;font-weight:bold">0</span>, <span style="color:#00d;font-weight:bold">6</span>], [<span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">0</span>], [<span style="color:#00d;font-weight:bold">2</span>, <span style="color:#00d;font-weight:bold">0</span>]])
b = np.array([<span style="color:#00d;font-weight:bold">1</span>, <span style="color:#00d;font-weight:bold">2</span>, <span style="color:#00d;font-weight:bold">4</span>])
x = least_square(A, b)
ax.scatter(*A.T)
domain = np.linspace(<span style="color:#00d;font-weight:bold">0</span>, <span style="color:#00d;font-weight:bold">2</span>)
<span style="color:#080;font-weight:bold">print</span>(<span style="color:#d20;background-color:#fff0f0">&#39;Least square solution for Ax=b: &#39;</span>, x)
ax.plot(domain, domain*x[<span style="color:#00d;font-weight:bold">1</span>] + x[<span style="color:#00d;font-weight:bold">0</span>])</code></pre></div>
</div>
<pre class="example">
Least square solution for Ax=b:  [2.   0.17]
</pre>
<p><img src="./jupyter/9ac60e73b05feede6aacc6d059834f1a1d1760ea.png" alt="./jupyter/9ac60e73b05feede6aacc6d059834f1a1d1760ea.png" title="./jupyter/9ac60e73b05feede6aacc6d059834f1a1d1760ea.png" /></p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-22" class="outline-2">
<h2 id="headline-22">
Krylov subspace methods
</h2>
<div id="outline-text-headline-22" class="outline-text-2">
<div id="outline-container-headline-23" class="outline-3">
<h3 id="headline-23">
Relation with fixed-point iterations
</h3>
<div id="outline-text-headline-23" class="outline-text-3">
<img src="images/Krylov_subspace_methods/2021-07-10_10-04-13_screenshot.png" alt="images/Krylov_subspace_methods/2021-07-10_10-04-13_screenshot.png" title="images/Krylov_subspace_methods/2021-07-10_10-04-13_screenshot.png" width="550px"/>
</div>
</div>
<div id="outline-container-headline-24" class="outline-3">
<h3 id="headline-24">
Definition
</h3>
<div id="outline-text-headline-24" class="outline-text-3">
<p>
Krylov subspace methods are iterative methods that use the Krylov subspace.
The solution approximation is in the Krylov subspace, which is cheap to construct, just requires matrix vector multiplication.
Specially cheap if we are dealing with sparse matrices.</p>
<p>
The Krylov space by construction has bad condition number.</p>
<p>Arnoldi algorithm, for instance, solves that by generating a orthonormal basis for it.</p>
</div>
</div>
<div id="outline-container-headline-25" class="outline-3">
<h3 id="headline-25">
Projection onto Krylov subspaces
</h3>
</div>
<div id="outline-container-headline-26" class="outline-3">
<h3 id="headline-26">
GMRES
</h3>
<div id="outline-text-headline-26" class="outline-text-3">
<p>In order to find the linear combination of the Krylov column vectors we impose that the residual at each step <span style="text-decoration: underline;">is minimum</span>.</p>
<img src="images/Krylov_subspace_methods/2021-07-16_07-48-23_screenshot.png" alt="images/Krylov_subspace_methods/2021-07-16_07-48-23_screenshot.png" title="images/Krylov_subspace_methods/2021-07-16_07-48-23_screenshot.png" width="550px"/>
</div>
</div>
<div id="outline-container-headline-27" class="outline-3">
<h3 id="headline-27">
GMRES and least squares
</h3>
<div id="outline-text-headline-27" class="outline-text-3">
<p>This minimization constraint, minimum residual, is solved using the least square method.</p>
</div>
</div>
<div id="outline-container-headline-28" class="outline-3">
<h3 id="headline-28">
GMRES and Arnoldi
</h3>
<div id="outline-text-headline-28" class="outline-text-3">
<p>GMRES uses Arnoldi to simplify the minimization problem.</p>
</div>
</div>
<div id="outline-container-headline-29" class="outline-3">
<h3 id="headline-29">
Implementation
</h3>
<div id="outline-text-headline-29" class="outline-text-3">
<figure>
<img src="images/Krylov_subspace_methods/2021-07-15_20-38-48_screenshot.png" alt="images/Krylov_subspace_methods/2021-07-15_20-38-48_screenshot.png" title="images/Krylov_subspace_methods/2021-07-15_20-38-48_screenshot.png" width="450px"/>
<figcaption>
Trefethen and Bau, 1997.
</figcaption>
</figure>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">gmres</span>(A: np.ndarray,
          b: np.ndarray,
          max_iter: <span style="color:#038">int</span> = <span style="color:#00d;font-weight:bold">200</span>,
          tol: <span style="color:#038">float</span> = <span style="color:#00d;font-weight:bold">1e-8</span>) -&gt; np.ndarray:
    <span style="color:#d20;background-color:#fff0f0">&#34;&#34;&#34;Solve Ax=b using GMRES.&#34;&#34;&#34;</span>
    m = A.shape[<span style="color:#00d;font-weight:bold">0</span>]
    x = np.zeros(m)
    num_iter = <span style="color:#00d;font-weight:bold">0</span>
    residuals = []
    <span style="color:#080;font-weight:bold">for</span> n <span style="color:#080">in</span> <span style="color:#038">range</span>(max_iter):
        H, Q = arnoldi(A, b, n)
        rhs = np.zeros(n+<span style="color:#00d;font-weight:bold">1</span>); rhs[<span style="color:#00d;font-weight:bold">0</span>] = np.linalg.norm(b) 
        y = least_square(H, rhs)
        x = Q[:, :n] <span style="color:#a61717;background-color:#e3d2d2">@</span> y
        r = np.linalg.norm(H <span style="color:#a61717;background-color:#e3d2d2">@</span> y - rhs)
        residuals.append(r)
        <span style="color:#080;font-weight:bold">if</span> r &lt; tol:
            <span style="color:#080;font-weight:bold">break</span>
        num_iter += <span style="color:#00d;font-weight:bold">1</span>
    <span style="color:#080;font-weight:bold">return</span> x, num_iter, residuals</code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-30" class="outline-3">
<h3 id="headline-30">
Example
</h3>
<div id="outline-text-headline-30" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">np.random.seed(<span style="color:#00d;font-weight:bold">2</span>)
size = <span style="color:#00d;font-weight:bold">5</span>
A = np.random.random((size,size))
<span style="color:#080;font-weight:bold">print</span>(<span style="color:#d20;background-color:#fff0f0">&#39;A=</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0">&#39;</span>, A)
b = np.random.random(size)
<span style="color:#080;font-weight:bold">print</span>(<span style="color:#d20;background-color:#fff0f0">&#39;b=</span><span style="color:#04d;background-color:#fff0f0">\n</span><span style="color:#d20;background-color:#fff0f0">&#39;</span>, b)
<span style="color:#080;font-weight:bold">print</span>(<span style="color:#d20;background-color:#fff0f0">&#39;Numpy: &#39;</span>, np.linalg.solve(A, b))
x, num_iter, _ = gmres(A, b)
<span style="color:#080;font-weight:bold">print</span>(<span style="color:#d20;background-color:#fff0f0">&#34;GMRES: &#34;</span>, x, <span style="color:#d20;background-color:#fff0f0">&#34;num_iter: &#34;</span>, num_iter)</code></pre></div>
</div>
<pre class="example">
A=
 [[0.44 0.03 0.55 0.44 0.42]
 [0.33 0.2  0.62 0.3  0.27]
 [0.62 0.53 0.13 0.51 0.18]
 [0.79 0.85 0.49 0.85 0.08]
 [0.51 0.07 0.43 0.1  0.13]]
b=
 [0.6  0.23 0.11 0.22 0.35]
Numpy:  [ 0.62 -1.42  0.21  1.04 -0.49]
GMRES:  [ 0.62 -1.42  0.21  1.04 -0.49] num_iter:  5
</pre>
</div>
</div>
<div id="outline-container-headline-31" class="outline-3">
<h3 id="headline-31">
Analysis of residual
</h3>
<div id="outline-text-headline-31" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib</span>
matplotlib.style.use(<span style="color:#d20;background-color:#fff0f0">&#39;ggplot&#39;</span>)
np.random.seed(<span style="color:#00d;font-weight:bold">2</span>)

size = <span style="color:#00d;font-weight:bold">20</span>
A = np.random.random((size,size))
b = np.random.random(size)
%timeit x, num_iter, r = gmres(A, b)

plt.plot(r);plt.xlabel(<span style="color:#d20;background-color:#fff0f0">&#39;iteration&#39;</span>);plt.ylabel(<span style="color:#d20;background-color:#fff0f0">&#39;residual norm&#39;</span>)</code></pre></div>
</div>
<pre class="example">
18 ms ± 517 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre>
<p><img src="./jupyter/d656a4b1c095afd9dc922d7a9ec9f9a70d9d8774.png" alt="./jupyter/d656a4b1c095afd9dc922d7a9ec9f9a70d9d8774.png" title="./jupyter/d656a4b1c095afd9dc922d7a9ec9f9a70d9d8774.png" /></p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-32" class="outline-2">
<h2 id="headline-32">
Multigrid methods
</h2>
<div id="outline-text-headline-32" class="outline-text-2">
<div id="outline-container-headline-33" class="outline-3">
<h3 id="headline-33">
Setup phase
</h3>
<div id="outline-text-headline-33" class="outline-text-3">
<p>
In this phase we need to construct the operators for each level.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-34" class="outline-2">
<h2 id="headline-34">
Diagonal dominance and convergence of fixed-point methods
</h2>
<div id="outline-text-headline-34" class="outline-text-2">
<div id="outline-container-headline-35" class="outline-3">
<h3 id="headline-35">
Prologue
</h3>
<div id="outline-text-headline-35" class="outline-text-3">
<p>Fixed point methods are also refereed as relaxation methods due their historical application to problems models with &#34;div (grad)&#34; operator, or Laplacian.</p>
</div>
</div>
<div id="outline-container-headline-36" class="outline-3">
<h3 id="headline-36">
Derivation Jacobi
</h3>
<div id="outline-text-headline-36" class="outline-text-3">
<img src="Diagonal_dominance_and_convergence_of_fixed-point_methods/2021-07-01_15-01-57_screenshot.png" alt="Diagonal_dominance_and_convergence_of_fixed-point_methods/2021-07-01_15-01-57_screenshot.png" title="Diagonal_dominance_and_convergence_of_fixed-point_methods/2021-07-01_15-01-57_screenshot.png" width="350px"/>
</div>
</div>
<div id="outline-container-headline-37" class="outline-3">
<h3 id="headline-37">
Diagonal dominant matrix
</h3>
<div id="outline-text-headline-37" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">numpy</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">np</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06b;font-weight:bold">jacobi</span>(A, b, x, n=<span style="color:#00d;font-weight:bold">100</span>, tol=<span style="color:#00d;font-weight:bold">1e-12</span>):
    D = np.diag(A)              <span style="color:#888"># just a 1d array</span>
    R = A - np.diagflat(D)      <span style="color:#888"># diagflat matrix with diagonal</span>
    error = <span style="color:#00d;font-weight:bold">1</span>
    i = <span style="color:#00d;font-weight:bold">0</span>
    e = []
    <span style="color:#080;font-weight:bold">while</span> error &gt; tol:
        x = (b - R <span style="color:#a61717;background-color:#e3d2d2">@</span> x) / D
        i += <span style="color:#00d;font-weight:bold">1</span>
        <span style="color:#080;font-weight:bold">if</span> i == n: <span style="color:#080;font-weight:bold">break</span>
        error = np.linalg.norm(b - A <span style="color:#a61717;background-color:#e3d2d2">@</span> x)
        e.append(error)
    <span style="color:#080;font-weight:bold">return</span> x, i, e</code></pre></div>
</div>
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib.pyplot</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#b06;font-weight:bold">plt</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#b06;font-weight:bold">matplotlib</span>
matplotlib.style.use(<span style="color:#d20;background-color:#fff0f0">&#39;ggplot&#39;</span>)

A = np.array([[<span style="color:#00d;font-weight:bold">9</span>, <span style="color:#00d;font-weight:bold">2</span>], [<span style="color:#00d;font-weight:bold">3</span>, <span style="color:#00d;font-weight:bold">5</span>]])
b = A[:, <span style="color:#00d;font-weight:bold">0</span>]
x = b * <span style="color:#00d;font-weight:bold">0</span>
<span style="color:#080;font-weight:bold">print</span>(A, b)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Exact sol: {np.linalg.solve(A, b)}&#39;</span>)
x, i, e = jacobi(A, b, x)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Iter sol: {x} in {i} iterations&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Condition number {np.linalg.cond(A)}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Eigenvalues {np.linalg.eigvals(A)}&#39;</span>)
plt.plot(e);plt.xlabel(<span style="color:#d20;background-color:#fff0f0">&#39;iteration&#39;</span>);plt.ylabel(<span style="color:#d20;background-color:#fff0f0">&#39;residual norm&#39;</span>)</code></pre></div>
</div>
<pre class="example">
[[9 2]
 [3 5]] [9 3]
Exact sol: [1. 0.]
Iter sol: [1. 0.] in 30 iterations
Condition number 2.677847838291863
Eigenvalues [10.16227766  3.83772234]
</pre>
<p><img src="./jupyter/7270276a530723e7f2f2c4b51086384b47b8762b.png" alt="./jupyter/7270276a530723e7f2f2c4b51086384b47b8762b.png" title="./jupyter/7270276a530723e7f2f2c4b51086384b47b8762b.png" /></p>
<p>
Remarks:</p>
<ol>
<li>
<p>$A$ is diagonally dominant because the diagonal element is greater than the sum of the off diagonal elements.</p>
</li>
<li>
<p>convergence in 30 iterations.</p>
</li>
<li>
<p>small condition number.</p>
</li>
</ol>
</div>
</div>
<div id="outline-container-headline-38" class="outline-3">
<h3 id="headline-38">
Non diagonal dominant
</h3>
<div id="outline-text-headline-38" class="outline-text-3">
<div class="src src-python">
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">A = np.array([[<span style="color:#00d;font-weight:bold">9</span>, <span style="color:#00d;font-weight:bold">100</span>], [<span style="color:#00d;font-weight:bold">2</span>, <span style="color:#00d;font-weight:bold">5</span>]]) 
b = A[:, <span style="color:#00d;font-weight:bold">0</span>]
x = b * <span style="color:#00d;font-weight:bold">0</span>
<span style="color:#080;font-weight:bold">print</span>(A, b)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Exact sol: {np.linalg.solve(A, b)}&#39;</span>)
x, i, e = jacobi(A, b, x)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Iter sol: {x} in {i} iterations&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Condition number {np.linalg.cond(A)}&#39;</span>)
<span style="color:#080;font-weight:bold">print</span>(f<span style="color:#d20;background-color:#fff0f0">&#39;Eigenvalues {np.linalg.eigvals(A)}&#39;</span>)
plt.plot(e);plt.xlabel(<span style="color:#d20;background-color:#fff0f0">&#39;iteration&#39;</span>);plt.ylabel(<span style="color:#d20;background-color:#fff0f0">&#39;residual norm&#39;</span>)</code></pre></div>
</div>
<pre class="example">
[[  9 100]
 [  2   5]] [9 2]
Exact sol: [ 1. -0.]
Iter sol: [-2.45965443e+32  0.00000000e+00] in 100 iterations
Condition number 65.21047149118199
Eigenvalues [21.28285686 -7.28285686]
</pre>
<p><img src="./jupyter/de669aaa273dd6a7fa2b1b8a2a0df019f22cf638.png" alt="./jupyter/de669aaa273dd6a7fa2b1b8a2a0df019f22cf638.png" title="./jupyter/de669aaa273dd6a7fa2b1b8a2a0df019f22cf638.png" /></p>
<p>
Remarks:</p>
<ol>
<li>
<p>residual exploded and solution did not converged.</p>
</li>
<li>
<p>high condition number.</p>
</li>
<li>
<p>eigenvalues spread apart in a wider range.</p>
</li>
</ol>
</div>
</div>
</div>
</div>


              
                  

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>
              
          </article>
          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="http://localhost:1313/tags/draft/">draft</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="http://localhost:1313/tags/python/">python</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="http://localhost:1313/tags/numerical-analysis/">numerical analysis</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="http://localhost:1313/tags/linear-algebra/">linear algebra</a>
    </li></ul>

 <div class="pagination">
  
    <a class="pagination__item" href="http://localhost:1313/notes/scientific-computing/">
        <span class="pagination__label">Previous Post</span>
        <span class="pagination__title">Where does a simulation come from</span>
    </a>
  

  
    <a class="pagination__item" href="http://localhost:1313/notes/average-purchase-cost/">
      <span class="pagination__label">Next Post</span>
      <span class="pagination__title" >Average purchase cost of an asset</span>
    </a>
  
</div>

          <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "nasseralkmim" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          <footer class="post__footer">
            


<div class="social-icons">
  
     
    
      <a class="social-icons__link" rel="me" title="Email"
         href="mailto:nasser.alkmim@gmail.com"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://localhost:1313/svg/email.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="LinkedIn"
         href="https://www.linkedin.com/in/nasser-alkmim-300882a6/"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://localhost:1313/svg/linkedin.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="GitHub"
         href="https://github.com/nasseralkmim"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://localhost:1313/svg/github.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" rel="me" title="Instagram"
         href="https://instagram.com/naszr"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('http://localhost:1313/svg/instagram.svg')"></div>
      </a>
    
     
</div>

            <p>© 2021</p>
          </footer>
          </div>
      </div>
      
      <div class="toc-container">
           <div class="toc-post-title">Numerical analysis notes</div> 
        <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Fixed point methods</a>
<ul>
<li><a href="#headline-2">Definition</a>
</li>
<li><a href="#headline-3">General implementation</a>
</li>
<li><a href="#headline-4">Jacobi</a>
</li>
<li><a href="#headline-5">Gauss Seidel</a>
</li>
</ul>
</li>
<li><a href="#headline-6">QR decomposition</a>
<ul>
<li><a href="#headline-7">Definition</a>
</li>
<li><a href="#headline-8">Implementation</a>
</li>
<li><a href="#headline-9">Simple example</a>
</li>
<li><a href="#headline-10">QR and symmetric matrices</a>
</li>
<li><a href="#headline-11">Backward and forward substitution</a>
</li>
</ul>
</li>
<li><a href="#headline-12">Arnoldi iterations</a>
<ul>
<li><a href="#headline-13">Definition</a>
</li>
<li><a href="#headline-14">Implementation</a>
</li>
<li><a href="#headline-15">Example</a>
</li>
<li><a href="#headline-16">Symmetric matrices</a>
</li>
<li><a href="#headline-17">Relation with Kyrlov subspaces</a>
</li>
</ul>
</li>
<li><a href="#headline-18">Least squares</a>
<ul>
<li><a href="#headline-19">Definition</a>
</li>
<li><a href="#headline-20">Implementation</a>
</li>
<li><a href="#headline-21">Visualization</a>
</li>
</ul>
</li>
<li><a href="#headline-22">Krylov subspace methods</a>
<ul>
<li><a href="#headline-23">Relation with fixed-point iterations</a>
</li>
<li><a href="#headline-24">Definition</a>
</li>
<li><a href="#headline-25">Projection onto Krylov subspaces</a>
</li>
<li><a href="#headline-26">GMRES</a>
</li>
<li><a href="#headline-27">GMRES and least squares</a>
</li>
<li><a href="#headline-28">GMRES and Arnoldi</a>
</li>
<li><a href="#headline-29">Implementation</a>
</li>
<li><a href="#headline-30">Example</a>
</li>
<li><a href="#headline-31">Analysis of residual</a>
</li>
</ul>
</li>
<li><a href="#headline-32">Multigrid methods</a>
<ul>
<li><a href="#headline-33">Setup phase</a>
</li>
</ul>
</li>
<li><a href="#headline-34">Diagonal dominance and convergence of fixed-point methods</a>
<ul>
<li><a href="#headline-35">Prologue</a>
</li>
<li><a href="#headline-36">Derivation Jacobi</a>
</li>
<li><a href="#headline-37">Diagonal dominant matrix</a>
</li>
<li><a href="#headline-38">Non diagonal dominant</a>
</li>
</ul>
</li>
</ul>
</nav>
      </div>
      
    </div>
    

  </main>

   

  
  <script src="/js/index.min.575dda8d49ee02639942c63564273e6da972ab531dda26a08800bdcb477cbd7f.js" integrity="sha256-V13ajUnuAmOZQsY1ZCc&#43;balyq1Md2iagiAC9y0d8vX8=" crossorigin="anonymous"></script>
  
  
  

  
  
  

  
    <script src="/js/table-of-contents.js"></script>
  


</body>

</html>
