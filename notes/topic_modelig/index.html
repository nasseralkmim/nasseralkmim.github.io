<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="../../lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Topic modeling | Notes repository</title>
  <link rel = 'canonical' href = 'https://nasseralkmim.github.io/notes/topic_modelig/'>
  <meta name="description" content="This is a page where I collect some of my post-worthy notes and some projects that I have worked on.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Topic modeling" />
<meta property="og:description" content="Introduction Topic modeling is a form of semantic analysis, a step forwarding finding meaning from word counts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nasseralkmim.github.io/notes/topic_modelig/" /><meta property="article:section" content="notes" />
<meta property="article:published_time" content="2020-12-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-12-11T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Topic modeling"/>
<meta name="twitter:description" content="Introduction Topic modeling is a form of semantic analysis, a step forwarding finding meaning from word counts."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://nasseralkmim.github.io/css/styles.c8c8c50244e0ca3193992f4e67683c8da29b4fca0be3d366b16ebd56ae150185516d4fa17249d511149028dada597df7392da249242424da6deab9a47fd085f1.css" integrity="sha512-yMjFAkTgyjGTmS9OZ2g8jaKbT8oL49NmsW69Vq4VAYVRbU&#43;hcknVERSQKNraWX33OS2iSSQkJNpt6rmkf9CF8Q=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://nasseralkmim.github.io/images/favicon.ico" />

  
  
  
  
  
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-74704246-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
<script src=../../js/toc.js></script>
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="../../">home</a></li>
         
        <li><a href="../../notes">notes</a></li>
         
        <li><a href="../../tags">tags</a></li>
         
        <li><a href="../../about">about</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://nasseralkmim.github.io/notes/nlp-python/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://nasseralkmim.github.io/notes/extrator-dividendos/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&text=Topic%20modeling" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&title=Topic%20modeling" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&is_video=false&description=Topic%20modeling" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Topic%20modeling&body=Check out this article: https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&title=Topic%20modeling" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&title=Topic%20modeling" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&name=Topic%20modeling&description=Introduction%20Topic%20modeling%20is%20a%20form%20of%20semantic%20analysis%2c%20a%20step%20forwarding%20finding%20meaning%20from%20word%20counts." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&t=Topic%20modeling" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Introduction</a>
</li>
<li><a href="#headline-2">Latent Dirichlet Allocation</a>
<ul>
<li><a href="#headline-3">Gensim</a>
</li>
<li><a href="#headline-4">pyLDAvis</a>
</li>
</ul>
</li>
<li><a href="#headline-5">LDA procedure example</a>
<ul>
<li><a href="#headline-6">Load the data</a>
</li>
<li><a href="#headline-7">Preprocessing</a>
<ul>
<li><a href="#headline-8">Lower case</a>
</li>
<li><a href="#headline-9">Tokenize each post</a>
</li>
<li><a href="#headline-10">Removing punctuation</a>
</li>
<li><a href="#headline-11">Removing stopwords</a>
</li>
<li><a href="#headline-12">Removing tokens with less the 4 letters</a>
</li>
<li><a href="#headline-13">Removing empty posts</a>
</li>
<li><a href="#headline-14">Summary preprocessing DataFrame</a>
</li>
</ul>
</li>
<li><a href="#headline-15">LDA with Gensim</a>
<ul>
<li><a href="#headline-16">Prepare the corpus</a>
</li>
<li><a href="#headline-17">Transform documents to vectorized form</a>
</li>
<li><a href="#headline-18">Training</a>
</li>
<li><a href="#headline-19">Training output</a>
</li>
</ul>
</li>
<li><a href="#headline-20">Visualizing pyLDAvis</a>
<ul>
<li><a href="#headline-21">Analysis</a>
</li>
<li><a href="#headline-22">Points of improvements</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Topic modeling
      </h1>
      <div class="meta">
        
        
        
        
        
        
        
        
        
        <div class="postdate">
          
          <time datetime="2020-12-11 00:00:00 &#43;0000 UTC" itemprop="datePublished">Dec 11 2020</time>
          
        </div>
        
        
        <div class="article-read-time">
          <i class="far fa-clock"></i>
          
          8 minute read
        </div>
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="../../tags/natural-language-processing" rel="tag">natural-language-processing</a>
            
             ,  
            <a class="tag-link" href="../../tags/data-analysis" rel="tag">data-analysis</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Introduction
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Topic modeling is a form of semantic analysis, a step forwarding finding meaning from word counts.
This analysis allows discovery of document topic without trainig data.
It involves counting words and grouping similar word patterns to describe the data.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Latent Dirichlet Allocation
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>
Latent Dirichlet Allocation (LDA) is one topic modeling technique.
It can infer the probability distribution of words for each topic, characterizing it.
It also defines a distribution of topics through the documents.</p>
<p>
More information about the LDA model:</p>
<ol>
<li><a href="https://papers.nips.cc/paper/2010/file/71f6278d140af599e06ad9bf1ba03cb0-Paper.pdf">https://papers.nips.cc/paper/2010/file/71f6278d140af599e06ad9bf1ba03cb0-Paper.pdf</a></li>
<li><a href="https://bookdown.org/Maxine/tidy-text-mining/latent-dirichlet-allocation.html">https://bookdown.org/Maxine/tidy-text-mining/latent-dirichlet-allocation.html</a></li>
</ol>
<div id="outline-container-headline-3" class="outline-4">
<h4 id="headline-3">
Gensim
</h4>
<div id="outline-text-headline-3" class="outline-text-4">
<p>
Gesim is library for topic modeling that has LDA algorithm implemented.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-4">
<h4 id="headline-4">
pyLDAvis
</h4>
<div id="outline-text-headline-4" class="outline-text-4">
<p>pyLDAvis is library that helps visualize LDA outputs.
It can generate an interactive </p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
LDA procedure example
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<div id="outline-container-headline-6" class="outline-4">
<h4 id="headline-6">
Load the data
</h4>
<div id="outline-text-headline-6" class="outline-text-4">
<p>
I will use the data from portuguese blog posts from <a href="https://www.inf.pucrs.br/linatural/wordpress/recursos-e-ferramentas/blogset-br/">BLOGSET-BR</a>.
I&#39;m limiting the analysis to just 1000 blog posts in order to keep the code running fast in this notebook.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">pandas</span> <span style="color:#a2f;font-weight:bold">as</span> <span style="color:#00f;font-weight:bold">pd</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>posts_data <span style="color:#666">=</span> pd<span style="color:#666">.</span>read_csv(<span style="color:#b44">&#39;C:/Users/nasse/Desktop/blogset-br.csv/blogset-br.csv&#39;</span>, header<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">None</span>, nrows<span style="color:#666">=</span><span style="color:#666">1000</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(posts_data<span style="color:#666">.</span>shape)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#a2f">print</span>(posts_data<span style="color:#666">.</span>head())</span></span></code></pre></div>
</div>
<pre class="example">
(1000, 9)
                     0                    1                          2  \
0  4513095612773714447  1000016902259367892  2012-01-27T13:30:00-02:00   
1  4402618022359447709  1000016902259367892  2011-07-25T21:43:00-03:00   
2  4903861431859076038  1000016902259367892  2011-10-06T23:39:00-03:00   
3  5936720117277385447  1000016902259367892  2011-07-25T21:46:00-03:00   
4  9035220881064614540  1000016902259367892  2011-05-04T00:09:00-03:00   

                                 3  \
0          Ombré nails  como fazer   
1                   RISQUÉ - COLOR   
2                      Risque Dogs   
3  Risqué coleção nova da Penelope   
4       Coleção 2011 MOHDA INVERNO   

                                                   4                     5  \
0                                                 \n  01861978533047910632   
1    SÃAAAO MUITOO LINDOS AMEEI OOO MIRAGEM AZUL *-*  01861978533047910632   
2  A Nova coleção da Risqué veeeeio ANIMAL hehe c...  01861978533047910632   
3                                           esmaltes  01861978533047910632   
4  A MOHDA nesse inverno enta trazendo para nos v...  01861978533047910632   

         6  7    8  
0  Daniela  1  NaN  
1  Daniela  0  NaN  
2  Daniela  3  NaN  
3  Daniela  0  NaN  
4  Daniela  0  NaN
</pre>
<p>
We are only interested in the blog content, so we drop all columns except the one with content which is the 4th column.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>posts <span style="color:#666">=</span> posts_data[<span style="color:#666">4</span>]<span style="color:#666">.</span>to_frame()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>posts<span style="color:#666">.</span>columns <span style="color:#666">=</span> [<span style="color:#b44">&#39;content&#39;</span>]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#a2f">print</span>(posts<span style="color:#666">.</span>head())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(posts<span style="color:#666">.</span>columns)</span></span></code></pre></div>
</div>
<pre class="example">
                                             content
0                                                 \n
1    SÃAAAO MUITOO LINDOS AMEEI OOO MIRAGEM AZUL *-*
2  A Nova coleção da Risqué veeeeio ANIMAL hehe c...
3                                           esmaltes
4  A MOHDA nesse inverno enta trazendo para nos v...
Index([&#39;content&#39;], dtype=&#39;object&#39;)
</pre>
</div>
</div>
<div id="outline-container-headline-7" class="outline-4">
<h4 id="headline-7">
Preprocessing
</h4>
<div id="outline-text-headline-7" class="outline-text-4">
<div id="outline-container-headline-8" class="outline-6">
<h6 id="headline-8">
Lower case
</h6>
<div id="outline-text-headline-8" class="outline-text-6">
<p>First step is to make every thing lower case using the vectorize string function in pandas.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>posts[<span style="color:#b44">&#39;lower&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;content&#39;</span>]<span style="color:#666">.</span>str<span style="color:#666">.</span>lower() <span style="color:#080;font-style:italic"># </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;lower&#39;</span>]<span style="color:#666">.</span>head())</span></span></code></pre></div>
</div>
<pre class="example">
0                                                   \n
1      sãaaao muitoo lindos ameei ooo miragem azul *-*
2    a nova coleção da risqué veeeeio animal hehe c...
3                                             esmaltes
4    a mohda nesse inverno enta trazendo para nos v...
Name: lower, dtype: object
</pre>
</div>
</div>
<div id="outline-container-headline-9" class="outline-6">
<h6 id="headline-9">
Tokenize each post
</h6>
<div id="outline-text-headline-9" class="outline-text-6">
<p>
We then tokenize each post using spaCy by loading the model (português one), which can be downloaded with <code class="verbatim">python -m spacy download pt_core_news_sm</code>.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">spacy</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>nlp <span style="color:#666">=</span> spacy<span style="color:#666">.</span>load(<span style="color:#b44">&#39;pt_core_news_sm&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>posts[<span style="color:#b44">&#39;tokens&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;lower&#39;</span>]<span style="color:#666">.</span>apply(nlp)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;tokens&#39;</span>]<span style="color:#666">.</span>head())</span></span></code></pre></div>
</div>
<pre class="example">
0                                                 (\n)
1    (sãaaao, muitoo, lindos, ameei, ooo, miragem, ...
2    (a, nova, coleção, da, risqué, veeeeio, animal...
3                                           (esmaltes)
4    (a, mohda, nesse, inverno, enta, trazendo, par...
Name: tokens, dtype: object
</pre>
<p>
Let&#39;s check the number of tokens in each post.
We can see the average tokens for each post.
A great part of those tokens are stopwords which does not contain much information, so we are removing them.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>posts[<span style="color:#b44">&#39;num_tokens&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;tokens&#39;</span>]<span style="color:#666">.</span>apply(<span style="color:#a2f">len</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;num_tokens&#39;</span>]<span style="color:#666">.</span>mean() )</span></span></code></pre></div>
</div>
<pre class="example">
287.099
</pre>
</div>
</div>
<div id="outline-container-headline-10" class="outline-6">
<h6 id="headline-10">
Removing punctuation
</h6>
<div id="outline-text-headline-10" class="outline-text-6">
<p>Reduces the average tokens.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>posts[<span style="color:#b44">&#39;tokens_nopunc&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;tokens&#39;</span>]<span style="color:#666">.</span>apply(<span style="color:#a2f;font-weight:bold">lambda</span> x: [tkn <span style="color:#a2f;font-weight:bold">for</span> tkn <span style="color:#a2f;font-weight:bold">in</span> x <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#a2f;font-weight:bold">not</span> tkn<span style="color:#666">.</span>is_punct])
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;tokens_nopunc&#39;</span>]<span style="color:#666">.</span>head())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>posts[<span style="color:#b44">&#39;num_tokens_nopunc&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;tokens_nopunc&#39;</span>]<span style="color:#666">.</span>apply(<span style="color:#a2f">len</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;num_tokens_nopunc&#39;</span>]<span style="color:#666">.</span>mean() )</span></span></code></pre></div>
</div>
<pre class="example">
0                                                 [\n]
1    [sãaaao, muitoo, lindos, ameei, ooo, miragem, ...
2    [a, nova, coleção, da, risqué, veeeeio, animal...
3                                           [esmaltes]
4    [a, mohda, nesse, inverno, enta, trazendo, par...
Name: tokens_nopunc, dtype: object
241.036
</pre>
</div>
</div>
<div id="outline-container-headline-11" class="outline-6">
<h6 id="headline-11">
Removing stopwords
</h6>
<div id="outline-text-headline-11" class="outline-text-6">
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f">print</span>(<span style="color:#a2f">list</span>(nlp<span style="color:#666">.</span>Defaults<span style="color:#666">.</span>stop_words)[:<span style="color:#666">20</span>])</span></span></code></pre></div>
</div>
<pre class="example">
[&#39;momento&#39;, &#39;foram&#39;, &#39;geral&#39;, &#39;onde&#39;, &#39;tiveram&#39;, &#39;seus&#39;, &#39;oito&#39;, &#39;além&#39;, &#39;aqui&#39;, &#39;podem&#39;, &#39;aquelas&#39;, &#39;por&#39;, &#39;sétima&#39;, &#39;acerca&#39;, &#39;primeiro&#39;, &#39;nuns&#39;, &#39;estás&#39;, &#39;nossas&#39;, &#39;está&#39;, &#39;temos&#39;]
</pre>
<p>
Then we remove the stop words using the spaCy collection of stopwords, we can see that we reduced the average tokens to 63 per post.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#a2f;font-weight:bold">def</span> <span style="color:#00a000">remove_stopwords</span>(tokens):
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    tokens_nosw <span style="color:#666">=</span> []
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#a2f;font-weight:bold">for</span> tkn <span style="color:#a2f;font-weight:bold">in</span> tokens:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>        <span style="color:#a2f;font-weight:bold">if</span> tkn<span style="color:#666">.</span>text<span style="color:#666">.</span>isspace():
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>            <span style="color:#a2f;font-weight:bold">continue</span>            <span style="color:#080;font-style:italic"># remove empty space</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>        <span style="color:#a2f;font-weight:bold">if</span> tkn<span style="color:#666">.</span>text <span style="color:#a2f;font-weight:bold">not</span> <span style="color:#a2f;font-weight:bold">in</span> nlp<span style="color:#666">.</span>Defaults<span style="color:#666">.</span>stop_words:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>            tokens_nosw<span style="color:#666">.</span>append(tkn)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    <span style="color:#a2f;font-weight:bold">return</span> tokens_nosw
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>posts[<span style="color:#b44">&#39;tokens_nosw&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;tokens_nopunc&#39;</span>]<span style="color:#666">.</span>apply(remove_stopwords)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;tokens_nosw&#39;</span>]<span style="color:#666">.</span>head())
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>posts[<span style="color:#b44">&#39;num_tokens_nosw&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;tokens_nosw&#39;</span>]<span style="color:#666">.</span>apply(<span style="color:#a2f">len</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;num_tokens_nosw&#39;</span>]<span style="color:#666">.</span>mean() )</span></span></code></pre></div>
</div>
<pre class="example">
0                                                   []
1    [sãaaao, muitoo, lindos, ameei, ooo, miragem, ...
2    [a, coleção, risqué, veeeeio, animal, hehe, co...
3                                           [esmaltes]
4    [a, mohda, inverno, enta, trazendo, viadas, es...
Name: tokens_nosw, dtype: object
139.142
</pre>
</div>
</div>
<div id="outline-container-headline-12" class="outline-6">
<h6 id="headline-12">
Removing tokens with less the 4 letters
</h6>
<div id="outline-text-headline-12" class="outline-text-6">
<p>
Usually smaller words don&#39;t carry much information, so we remove then.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>posts[<span style="color:#b44">&#39;tokens_clean&#39;</span>] <span style="color:#666">=</span> posts<span style="color:#666">.</span>tokens_nosw<span style="color:#666">.</span>apply(<span style="color:#a2f;font-weight:bold">lambda</span> x: [tkn <span style="color:#a2f;font-weight:bold">for</span> tkn <span style="color:#a2f;font-weight:bold">in</span> x <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#a2f">len</span>(tkn) <span style="color:#666">&gt;</span><span style="color:#666">4</span>])
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(posts<span style="color:#666">.</span>tokens_clean)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>posts[<span style="color:#b44">&#39;num_tokens_clean&#39;</span>] <span style="color:#666">=</span> posts[<span style="color:#b44">&#39;tokens_clean&#39;</span>]<span style="color:#666">.</span>apply(<span style="color:#a2f">len</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span><span style="color:#a2f">print</span>(posts[<span style="color:#b44">&#39;num_tokens_clean&#39;</span>]<span style="color:#666">.</span>mean() )</span></span></code></pre></div>
</div>
<pre class="example">
0                                                     []
1               [sãaaao, muitoo, lindos, ameei, miragem]
2      [coleção, risqué, veeeeio, animal, cores, clar...
3                                             [esmaltes]
4      [mohda, inverno, trazendo, viadas, esmaltes, c...
                             ...                        
995    [apaixonada, esportes, adolescência, curtia, v...
996    [enfim, dormir, acordar, trocar, noite, preocu...
997         [http://www.youtube.com/watch?v=-_wr1hy-bka]
998    [bullying, alguém, agride, humilha, xinga,&amp;nbs...
999    [mohandas, karamchand, gandhi, outubro, janeir...
Name: tokens_clean, Length: 1000, dtype: object
96.65
</pre>
</div>
</div>
<div id="outline-container-headline-13" class="outline-6">
<h6 id="headline-13">
Removing empty posts
</h6>
<div id="outline-text-headline-13" class="outline-text-6">
<p>
Now creating a new Series pandas object.
We filter the Series considering only entities with length greater than 0, then we call the attribute to convert each token into text.
At the end we have a list of list of strings.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>posts_clean <span style="color:#666">=</span> posts<span style="color:#666">.</span>tokens_clean[posts<span style="color:#666">.</span>tokens_clean<span style="color:#666">.</span>str<span style="color:#666">.</span>len() <span style="color:#666">&gt;</span> <span style="color:#666">0</span>]<span style="color:#666">.</span>apply(<span style="color:#a2f;font-weight:bold">lambda</span> x: [tkn<span style="color:#666">.</span>text <span style="color:#a2f;font-weight:bold">for</span> tkn <span style="color:#a2f;font-weight:bold">in</span> x])
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(posts_clean)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(<span style="color:#a2f">type</span>(posts_clean<span style="color:#666">.</span>tolist()[<span style="color:#666">0</span>]))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#a2f">print</span>(<span style="color:#a2f">type</span>(posts_clean<span style="color:#666">.</span>tolist()[<span style="color:#666">0</span>][<span style="color:#666">0</span>]))</span></span></code></pre></div>
</div>
<pre class="example">
1               [sãaaao, muitoo, lindos, ameei, miragem]
2      [coleção, risqué, veeeeio, animal, cores, clar...
3                                             [esmaltes]
4      [mohda, inverno, trazendo, viadas, esmaltes, c...
5      [susseso, filme, riqué, cores, vibrante, fizer...
                             ...                        
995    [apaixonada, esportes, adolescência, curtia, v...
996    [enfim, dormir, acordar, trocar, noite, preocu...
997         [http://www.youtube.com/watch?v=-_wr1hy-bka]
998    [bullying, alguém, agride, humilha, xinga,&amp;nbs...
999    [mohandas, karamchand, gandhi, outubro, janeir...
Name: tokens_clean, Length: 927, dtype: object
&lt;class &#39;list&#39;&gt;
&lt;class &#39;str&#39;&gt;
</pre>
</div>
</div>
<div id="outline-container-headline-14" class="outline-6">
<h6 id="headline-14">
Summary preprocessing DataFrame
</h6>
<div id="outline-text-headline-14" class="outline-text-6">
<p>
The full preprocess in the posts DataFrame, so we can visualiza each process.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>pd<span style="color:#666">.</span>set_option(<span style="color:#b44">&#39;max_columns&#39;</span>, <span style="color:#a2f;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(posts<span style="color:#666">.</span>head())</span></span></code></pre></div>
</div>
<pre class="example">
                                             content  \
0                                                 \n   
1    SÃAAAO MUITOO LINDOS AMEEI OOO MIRAGEM AZUL *-*   
2  A Nova coleção da Risqué veeeeio ANIMAL hehe c...   
3                                           esmaltes   
4  A MOHDA nesse inverno enta trazendo para nos v...   

                                               lower  \
0                                                 \n   
1    sãaaao muitoo lindos ameei ooo miragem azul *-*   
2  a nova coleção da risqué veeeeio animal hehe c...   
3                                           esmaltes   
4  a mohda nesse inverno enta trazendo para nos v...   

                                              tokens  num_tokens  \
0                                               (\n)           1   
1  (sãaaao, muitoo, lindos, ameei, ooo, miragem, ...          10   
2  (a, nova, coleção, da, risqué, veeeeio, animal...          27   
3                                         (esmaltes)           1   
4  (a, mohda, nesse, inverno, enta, trazendo, par...          49   

                                       tokens_nopunc  num_tokens_nopunc  \
0                                               [\n]                  1   
1  [sãaaao, muitoo, lindos, ameei, ooo, miragem, ...                  7   
2  [a, nova, coleção, da, risqué, veeeeio, animal...                 24   
3                                         [esmaltes]                  1   
4  [a, mohda, nesse, inverno, enta, trazendo, par...                 42   

                                         tokens_nosw  num_tokens_nosw  \
0                                                 []                0   
1  [sãaaao, muitoo, lindos, ameei, ooo, miragem, ...                7   
2  [a, coleção, risqué, veeeeio, animal, hehe, co...               19   
3                                         [esmaltes]                1   
4  [a, mohda, inverno, enta, trazendo, viadas, es...               26   

                                        tokens_clean  num_tokens_clean  
0                                                 []                 0  
1           [sãaaao, muitoo, lindos, ameei, miragem]                 5  
2  [coleção, risqué, veeeeio, animal, cores, clar...                12  
3                                         [esmaltes]                 1  
4  [mohda, inverno, trazendo, viadas, esmaltes, c...                17
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-15" class="outline-4">
<h4 id="headline-15">
LDA with Gensim
</h4>
<div id="outline-text-headline-15" class="outline-text-4">
<div id="outline-container-headline-16" class="outline-6">
<h6 id="headline-16">
Prepare the corpus
</h6>
<div id="outline-text-headline-16" class="outline-text-6">
<p>
The <code class="verbatim">LdaModel</code> object from Gensim takes in a corpus as parameter.
A corpus is a collection of <code class="verbatim">Documents</code> objects.
A <code class="verbatim">Document</code> object is simply a string of text.
This corpus is created from a list of documents with a list of tokens.</p>
<p>
The <code class="verbatim">Dictionary</code> class associates each word with a unique integer ID.
This is dictionary defines a vocabulary.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">gensim.corpora</span> <span style="color:#a2f;font-weight:bold">import</span> Dictionary
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>docs <span style="color:#666">=</span> posts_clean<span style="color:#666">.</span>tolist()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>dictionary <span style="color:#666">=</span> Dictionary(docs)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(dictionary)</span></span></code></pre></div>
</div>
<pre class="example">
Dictionary(34661 unique tokens: [&#39;ameei&#39;, &#39;lindos&#39;, &#39;miragem&#39;, &#39;muitoo&#39;, &#39;sãaaao&#39;]...)
</pre>
</div>
</div>
<div id="outline-container-headline-17" class="outline-6">
<h6 id="headline-17">
Transform documents to vectorized form
</h6>
<div id="outline-text-headline-17" class="outline-text-6">
<p>
In this step we convert a document into a numeric form so the algorithm can manipulate it.
This step is also known as bag-of-words representation of documents.
This function <code class="verbatim">doc2bow()</code> creates a tuple for each word with <code class="verbatim">(word_id, word_frquency)</code>.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>corpus <span style="color:#666">=</span> [dictionary<span style="color:#666">.</span>doc2bow(doc) <span style="color:#a2f;font-weight:bold">for</span> doc <span style="color:#a2f;font-weight:bold">in</span> docs]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#a2f">print</span>(corpus[<span style="color:#666">0</span>], docs[<span style="color:#666">0</span>])
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#a2f">print</span>(<span style="color:#b44">&#39;Number of unique tokens:&#39;</span>, <span style="color:#a2f">len</span>(dictionary))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(<span style="color:#b44">&#39;Number of posts:&#39;</span>, <span style="color:#a2f">len</span>(corpus))</span></span></code></pre></div>
</div>
<pre class="example">
[(0, 1), (1, 1), (2, 1), (3, 1), (4, 1)] [&#39;sãaaao&#39;, &#39;muitoo&#39;, &#39;lindos&#39;, &#39;ameei&#39;, &#39;miragem&#39;]
Number of unique tokens: 34661
Number of posts: 927
</pre>
</div>
</div>
<div id="outline-container-headline-18" class="outline-6">
<h6 id="headline-18">
Training
</h6>
<div id="outline-text-headline-18" class="outline-text-6">
<p>
In this step we need a couple of parameters to be set.
First the number of topics must be pre defined, I choose 10.
Chunk size controls how many documents are processed at a time.
Passes defined how often the model is trained on the corpus, same as &#39;epochs&#39;.
Iterations controls how often we repeat a particular loop over each document.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#a2f;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">gensim.models</span> <span style="color:#a2f;font-weight:bold">import</span> LdaModel
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>num_topics <span style="color:#666">=</span> <span style="color:#666">10</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>chunksize <span style="color:#666">=</span> <span style="color:#666">2000</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>passes <span style="color:#666">=</span> <span style="color:#666">20</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>iterations <span style="color:#666">=</span> <span style="color:#666">400</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>eval_every <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">None</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>id2word <span style="color:#666">=</span> dictionary
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>model <span style="color:#666">=</span> LdaModel(
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    corpus<span style="color:#666">=</span>corpus,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    id2word<span style="color:#666">=</span>id2word,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    chunksize<span style="color:#666">=</span>chunksize,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>    alpha<span style="color:#666">=</span><span style="color:#b44">&#39;auto&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>    eta<span style="color:#666">=</span><span style="color:#b44">&#39;auto&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>    iterations<span style="color:#666">=</span>iterations,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    num_topics<span style="color:#666">=</span>num_topics,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>    passes<span style="color:#666">=</span>passes,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>    eval_every<span style="color:#666">=</span>eval_every
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>model<span style="color:#666">.</span>save(<span style="color:#b44">f</span><span style="color:#b44">&#39;model_</span><span style="color:#b68;font-weight:bold">{</span><span style="color:#a2f">len</span>(corpus)<span style="color:#b68;font-weight:bold">}</span><span style="color:#b44">.gensim&#39;</span>)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-19" class="outline-6">
<h6 id="headline-19">
Training output
</h6>
<div id="outline-text-headline-19" class="outline-text-6">
<p>We can print the top topics from a particular document.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">pprint</span> <span style="color:#a2f;font-weight:bold">import</span> pprint
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>topics <span style="color:#666">=</span> model<span style="color:#666">.</span>top_topics(corpus)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>pprint(topics[<span style="color:#666">4</span>])
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#a2f">print</span>(docs[<span style="color:#666">4</span>])</span></span></code></pre></div>
</div>
<pre class="example">
([(0.0030817974, &#39;pessoas&#39;),
  (0.0029705719, &#39;trabalho&#39;),
  (0.0019567062, &#39;empresa&#39;),
  (0.0019483563, &#39;social&#39;),
  (0.0018672714, &#39;ficar&#39;),
  (0.0018014798, &#39;melhor&#39;),
  (0.0017869751, &#39;paciente&#39;),
  (0.0017729151, &#39;download&#39;),
  (0.0015917295, &#39;estamos&#39;),
  (0.0014970169, &#39;mesma&#39;),
  (0.0014943925, &#39;muitas&#39;),
  (0.0014523969, &#39;coisas&#39;),
  (0.0014118261, &#39;alguém&#39;),
  (0.0013802068, &#39;sendo&#39;),
  (0.001359764, &#39;mundo&#39;),
  (0.0013132734, &#39;brasil&#39;),
  (0.0013105941, &#39;contas&#39;),
  (0.0013103066, &#39;médicos&#39;),
  (0.0012967874, &#39;carminha&#39;),
  (0.0012708729, &#39;marido&#39;)],
 -5.887733908971602)
[&#39;susseso&#39;, &#39;filme&#39;, &#39;riqué&#39;, &#39;cores&#39;, &#39;vibrante&#39;, &#39;fizerma&#39;, &#39;nbsp;as&#39;, &#39;cores&#39;, &#39;caxinha&#39;, &#39;linda&#39;, &#39;hortencia&#39;, &#39;obsessão&#39;, &#39;fluor&#39;, &#39;laranja&#39;, &#39;amarelo&#39;, &#39;cores&#39;, &#39;vivas&#39;, &#39;otimas&#39;, &#39;serem&#39;, &#39;usada&#39;, &#39;primaver/&#39;, &#39;verão&#39;, &#39;cores&#39;, &#39;coleções&#39;, &#39;coleções&#39;, &#39;passadas&amp;nbsp&#39;, &#39;usaram&#39;, &#39;otima&#39;, &#39;opção&#39;, &#39;colocarem&#39;, &#39;merdaco&#39;, &#39;chamar&#39;, &#39;atenção&#39;, &#39;consumidoras&#39;, &#39;esmaltes.&amp;nbsp&#39;]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-20" class="outline-4">
<h4 id="headline-20">
Visualizing pyLDAvis
</h4>
<div id="outline-text-headline-20" class="outline-text-4">
<p>
This tools allows us to visualize the topics discovered, their importance, similarity between topics, and the relevant words of each topics.
The relevance is computed with a weighted average of the <strong>probability of the word given the topic</strong> and this probability normalized by the probability of the term.
If we adjust the slider on the top to 0, we are considering words that appeared mostly on a specific topic.</p>
<div class="src src-python">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">pyLDAvis.gensim</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>lda <span style="color:#666">=</span> LdaModel<span style="color:#666">.</span>load(<span style="color:#b44">&#39;model_927.gensim&#39;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>lda_display <span style="color:#666">=</span> pyLDAvis<span style="color:#666">.</span>gensim<span style="color:#666">.</span>prepare(lda, corpus, dictionary, sort_topics<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">False</span>) 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>pyLDAvis<span style="color:#666">.</span>save_html(lda_display, <span style="color:#b44">&#39;ldavis.html&#39;</span>)</span></span></code></pre></div>
</div>
<div id="outline-container-headline-21" class="outline-6">
<h6 id="headline-21">
Analysis
</h6>
<div id="outline-text-headline-21" class="outline-text-6">
<p>
From the model results we can make some observations:</p>
<ol>
<li>The 4th topic is the most important across the 1000 posts analyzed. It mostly likely refers to <strong>literature</strong> or <strong>culture</strong> because of the relevant terms: Machado de Assis, Shakespeare, José Alencar, poemas.</li>
<li>Topic 1 most likely refers to religion.</li>
<li>Topics 3, 5, 6, 7, 8 and 9 are clustered in a region which indicates that they have a similar topic. My guess is posts about the current news.</li>
</ol>
</div>
</div>
<div id="outline-container-headline-22" class="outline-6">
<h6 id="headline-22">
Points of improvements
</h6>
<div id="outline-text-headline-22" class="outline-text-6">
<ol>
<li>From the 4th topic we can see proper names separated, I could have used a POS tagging tool to join them in a single token.</li>
<li>From the 2nd and 10th topics, we can see a couple of words that do not helps in the topic analysis and could be filtered out.</li>
<li>Increase the data used for analysis.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>

    </div>
  </article>

   

<hr />
<h2>See Also</h2>
<ul>
  
  <li><a href="../../notes/nlp-python/">NLP with Python</a></li>
  
  <li><a href="../../notes/text-processing-python/">Text processing with spaCy</a></li>
  
  <li><a href="../../notes/question-classifier-python/">Question classifier preprocessing</a></li>
  
</ul>



  
  




  <div class="blog-post-comments">
    
      <div id="disqus_thread">
  <script type="text/javascript">
    (function() {
      
      
      
      
    
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'nasseralkmim';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

    
  </div>



  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="../../">home</a></li>
         
          <li><a href="../../notes">notes</a></li>
         
          <li><a href="../../tags">tags</a></li>
         
          <li><a href="../../about">about</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Introduction</a>
</li>
<li><a href="#headline-2">Latent Dirichlet Allocation</a>
<ul>
<li><a href="#headline-3">Gensim</a>
</li>
<li><a href="#headline-4">pyLDAvis</a>
</li>
</ul>
</li>
<li><a href="#headline-5">LDA procedure example</a>
<ul>
<li><a href="#headline-6">Load the data</a>
</li>
<li><a href="#headline-7">Preprocessing</a>
<ul>
<li><a href="#headline-8">Lower case</a>
</li>
<li><a href="#headline-9">Tokenize each post</a>
</li>
<li><a href="#headline-10">Removing punctuation</a>
</li>
<li><a href="#headline-11">Removing stopwords</a>
</li>
<li><a href="#headline-12">Removing tokens with less the 4 letters</a>
</li>
<li><a href="#headline-13">Removing empty posts</a>
</li>
<li><a href="#headline-14">Summary preprocessing DataFrame</a>
</li>
</ul>
</li>
<li><a href="#headline-15">LDA with Gensim</a>
<ul>
<li><a href="#headline-16">Prepare the corpus</a>
</li>
<li><a href="#headline-17">Transform documents to vectorized form</a>
</li>
<li><a href="#headline-18">Training</a>
</li>
<li><a href="#headline-19">Training output</a>
</li>
</ul>
</li>
<li><a href="#headline-20">Visualizing pyLDAvis</a>
<ul>
<li><a href="#headline-21">Analysis</a>
</li>
<li><a href="#headline-22">Points of improvements</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&text=Topic%20modeling" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&title=Topic%20modeling" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&is_video=false&description=Topic%20modeling" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Topic%20modeling&body=Check out this article: https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&title=Topic%20modeling" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&title=Topic%20modeling" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&name=Topic%20modeling&description=Introduction%20Topic%20modeling%20is%20a%20form%20of%20semantic%20analysis%2c%20a%20step%20forwarding%20finding%20meaning%20from%20word%20counts." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fnasseralkmim.github.io%2fnotes%2ftopic_modelig%2f&t=Topic%20modeling" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2024  Nasser 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="../../">home</a></li>
         
        <li><a href="../../notes">notes</a></li>
         
        <li><a href="../../tags">tags</a></li>
         
        <li><a href="../../about">about</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=../../lib/font-awesome/css/all.min.css>
<script src=../../lib/jquery/jquery.min.js></script>
<script src=../../js/main.js></script>

<script src=../../js/code-copy.js></script>



  


<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script defer language="javascript" type="text/javascript"  src="../../js/dynamic-toc.js"></script>

</html>
